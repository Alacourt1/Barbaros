<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Eskina - Sistema de Gestión</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-blue: #1a73e8;
            --dark-blue: #0d47a1;
            --light-blue: #e8f0fe;
            --accent-blue: #4285f4;
            --white: #ffffff;
            --gray-light: #f5f5f5;
            --gray-medium: #e0e0e0;
            --gray-dark: #757575;
            --success: #34a853;
            --warning: #f9a825;
            --danger: #ea4335;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 6px 16px rgba(0, 0, 0, 0.12);
            --radius: 12px;
            --radius-small: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Roboto', sans-serif;
        }

        body {
            background-color: #f8fafc;
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ===== PANTALLA DE LOGIN ===== */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--light-blue) 0%, var(--white) 100%);
            padding: 20px;
        }

        .login-card {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 420px;
            padding: 40px 35px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--primary-blue), var(--accent-blue));
        }

        .logo-container {
            margin-bottom: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .logo-icon {
            background-color: var(--primary-blue);
            color: var(--white);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .logo-text {
            font-size: 32px;
            font-weight: 700;
            color: var(--dark-blue);
            letter-spacing: 1px;
        }

        .logo-subtitle {
            color: var(--gray-dark);
            font-size: 16px;
            margin-bottom: 5px;
        }

        .user-type-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            border-radius: var(--radius-small);
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .user-type-btn {
            flex: 1;
            padding: 14px;
            background-color: var(--gray-light);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .user-type-btn.active {
            background-color: var(--primary-blue);
            color: var(--white);
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-blue);
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--gray-medium);
            border-radius: var(--radius-small);
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        .login-btn {
            background-color: var(--primary-blue);
            color: var(--white);
            border: none;
            border-radius: var(--radius-small);
            padding: 16px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .login-btn:hover {
            background-color: var(--dark-blue);
        }

        /* ===== DASHBOARD GENERAL ===== */
        .dashboard-container {
            display: none;
            min-height: 100vh;
        }

        .header {
            background-color: var(--white);
            box-shadow: var(--shadow);
            padding: 18px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--primary-blue);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 18px;
        }

        .user-name {
            font-weight: 500;
        }

        .logout-btn {
            background-color: transparent;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: var(--radius-small);
            transition: background-color 0.3s;
        }

        .logout-btn:hover {
            background-color: rgba(234, 67, 53, 0.1);
        }

        /* ===== DASHBOARD DEL DUEÑO ===== */
        .owner-dashboard {
            display: flex;
        }

        .sidebar {
            width: 260px;
            background-color: var(--white);
            box-shadow: var(--shadow);
            height: calc(100vh - 80px);
            padding: 25px 0;
            position: sticky;
            top: 80px;
            overflow-y: auto;
        }

        .sidebar-menu {
            list-style: none;
        }

        .menu-item {
            padding: 16px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: background-color 0.3s;
            border-left: 4px solid transparent;
            font-weight: 500;
        }

        .menu-item:hover, .menu-item.active {
            background-color: var(--light-blue);
            border-left-color: var(--primary-blue);
            color: var(--primary-blue);
        }

        .menu-icon {
            width: 24px;
            text-align: center;
            font-size: 20px;
        }

        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            max-height: calc(100vh - 80px);
        }

        .section-title {
            font-size: 28px;
            margin-bottom: 25px;
            color: var(--dark-blue);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .card {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .card-title {
            font-size: 18px;
            color: var(--gray-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--dark-blue);
            margin-bottom: 10px;
        }

        .card-change {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .positive {
            color: var(--success);
        }

        .negative {
            color: var(--danger);
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .chart-card {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
        }

        .chart-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--dark-blue);
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        .tables-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
        }

        .table-card {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
        }

        .table-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--dark-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            text-align: left;
            padding: 15px 10px;
            border-bottom: 2px solid var(--gray-medium);
            color: var(--dark-blue);
            font-weight: 600;
        }

        .table td {
            padding: 15px 10px;
            border-bottom: 1px solid var(--gray-light);
        }

        .table tr:hover {
            background-color: var(--light-blue);
        }

        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .badge-success {
            background-color: rgba(52, 168, 83, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background-color: rgba(249, 168, 37, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background-color: rgba(234, 67, 53, 0.1);
            color: var(--danger);
        }

        /* ===== DASHBOARD DEL EMPLEADO ===== */
        .employee-dashboard {
            padding-bottom: 100px; /* Espacio para el menú inferior */
        }

        .employee-header {
            background-color: var(--primary-blue);
            color: var(--white);
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .employee-header-logo {
            font-size: 24px;
            font-weight: 700;
        }

        .employee-content {
            padding: 25px;
        }

        /* Menú inferior del empleado */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--white);
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 10px 15px;
            border-radius: var(--radius-small);
            cursor: pointer;
            transition: background-color 0.3s;
            min-width: 90px;
        }

        .nav-item:hover, .nav-item.active {
            background-color: var(--light-blue);
        }

        .nav-icon {
            font-size: 24px;
            color: var(--gray-dark);
        }

        .nav-item.active .nav-icon {
            color: var(--primary-blue);
        }

        .nav-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-dark);
        }

        .nav-item.active .nav-label {
            color: var(--primary-blue);
        }

        /* ===== INTERFAZ DE VENTAS MEJORADA ===== */
        .sale-container {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }

        .products-section-emp {
            flex: 3;
            min-width: 300px;
        }

        .cart-section {
            flex: 2;
            min-width: 300px;
            position: sticky;
            top: 100px;
            height: fit-content;
        }

        .sale-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-container {
            display: flex;
            gap: 15px;
            flex: 1;
            max-width: 600px;
        }

        .search-bar {
            flex: 1;
            display: flex;
            align-items: center;
            background-color: var(--white);
            border-radius: var(--radius-small);
            box-shadow: var(--shadow);
            padding: 12px 18px;
        }

        .search-input {
            border: none;
            outline: none;
            flex: 1;
            padding-left: 12px;
            font-size: 16px;
        }

        .barcode-btn {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            border-radius: var(--radius-small);
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .product-card {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .product-img {
            width: 80px;
            height: 80px;
            background-color: var(--gray-light);
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-dark);
            font-size: 32px;
        }

        .product-name {
            font-weight: 600;
            margin-bottom: 8px;
            text-align: center;
            font-size: 16px;
        }

        .product-price {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 10px;
        }

        .product-code {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 10px;
        }

        .sale-cart {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
        }

        .cart-title {
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--dark-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--gray-light);
        }

        .cart-item-name {
            font-weight: 500;
            flex: 1;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            background-color: var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 700;
            font-size: 16px;
        }

        .cart-item-quantity {
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }

        .cart-item-price {
            font-weight: 600;
            color: var(--primary-blue);
            min-width: 70px;
            text-align: right;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 24px;
            font-weight: 700;
            padding: 20px 0;
            border-top: 2px solid var(--gray-medium);
            margin-top: 10px;
        }

        .payment-methods {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .payment-method {
            flex: 1;
            min-width: 100px;
            padding: 15px 10px;
            border: 2px solid var(--gray-medium);
            border-radius: var(--radius-small);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-method:hover, .payment-method.active {
            border-color: var(--primary-blue);
            background-color: var(--light-blue);
        }

        .payment-icon {
            font-size: 24px;
            color: var(--gray-dark);
        }

        .payment-method.active .payment-icon {
            color: var(--primary-blue);
        }

        .payment-label {
            font-weight: 500;
            font-size: 14px;
        }

        .complete-sale-btn {
            background-color: var(--success);
            color: var(--white);
            border: none;
            border-radius: var(--radius-small);
            padding: 18px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .complete-sale-btn:hover {
            background-color: #2a8b47;
        }

        /* Historial de ventas del día */
        .sales-history {
            margin-top: 40px;
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
        }

        .sales-history-title {
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--dark-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sales-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .sale-record {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid var(--gray-light);
            align-items: center;
        }

        .sale-record:hover {
            background-color: var(--light-blue);
        }

        .sale-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .sale-time {
            font-size: 14px;
            color: var(--gray-dark);
        }

        .sale-amount {
            font-weight: 700;
            font-size: 18px;
            color: var(--success);
        }

        .sale-method {
            font-size: 14px;
            color: var(--gray-dark);
        }

        /* Sección de productos y deudores (ocultas por defecto) */
        .products-section, .debtors-section {
            display: none;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .add-btn {
            background-color: var(--primary-blue);
            color: var(--white);
            border: none;
            border-radius: var(--radius-small);
            padding: 12px 20px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.3s;
        }

        .add-btn:hover {
            background-color: var(--dark-blue);
        }

        /* Sistema de deudores mejorado */
        .debtors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .debtor-card {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .debtor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .debtor-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark-blue);
        }

        .debtor-phone {
            color: var(--gray-dark);
            font-size: 14px;
        }

        .debtor-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .debtor-amount {
            font-size: 28px;
            font-weight: 700;
            color: var(--danger);
        }

        .debtor-date {
            font-size: 14px;
            color: var(--gray-dark);
        }

        .debtor-notes {
            background-color: var(--gray-light);
            padding: 10px;
            border-radius: var(--radius-small);
            font-size: 14px;
        }

        .debtor-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .action-btn {
            padding: 10px 15px;
            border: none;
            border-radius: var(--radius-small);
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            justify-content: center;
        }

        .edit-btn {
            background-color: var(--light-blue);
            color: var(--primary-blue);
        }

        .pay-btn {
            background-color: rgba(52, 168, 83, 0.1);
            color: var(--success);
        }

        .delete-btn {
            background-color: rgba(234, 67, 53, 0.1);
            color: var(--danger);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: var(--radius);
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 24px;
            color: var(--dark-blue);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--gray-dark);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Sistema de empleados mejorado */
        .employees-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .employee-card {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .employee-header-card {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .employee-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-blue);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
        }

        .employee-info {
            flex: 1;
        }

        .employee-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark-blue);
        }

        .employee-role {
            color: var(--gray-dark);
            font-size: 14px;
        }

        .employee-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray-dark);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark-blue);
        }

        .employee-schedule {
            background-color: var(--gray-light);
            padding: 15px;
            border-radius: var(--radius-small);
        }

        .schedule-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark-blue);
        }

        .schedule-days {
            display: flex;
            justify-content: space-between;
        }

        .day {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .day-name {
            font-size: 12px;
            color: var(--gray-dark);
        }

        .day-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .day-status.work {
            background-color: var(--success);
        }

        .day-status.free {
            background-color: var(--gray-medium);
        }

        /* Sistema de stock */
        .stock-table-container {
            overflow-x: auto;
        }

        .stock-table {
            width: 100%;
            min-width: 800px;
        }

        .stock-actions {
            display: flex;
            gap: 10px;
        }

        .stock-btn {
            padding: 6px 12px;
            border: none;
            border-radius: var(--radius-small);
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .add-stock-btn {
            background-color: rgba(52, 168, 83, 0.1);
            color: var(--success);
        }

        .remove-stock-btn {
            background-color: rgba(234, 67, 53, 0.1);
            color: var(--danger);
        }

        /* Sistema de proveedores */
        .suppliers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .supplier-card {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .supplier-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .supplier-name {
            font-size: 22px;
            font-weight: 600;
            color: var(--dark-blue);
        }

        .supplier-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-active {
            background-color: rgba(52, 168, 83, 0.1);
            color: var(--success);
        }

        .supplier-contact {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .supplier-products {
            background-color: var(--gray-light);
            padding: 15px;
            border-radius: var(--radius-small);
        }

        .products-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark-blue);
        }

        .products-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .product-tag {
            background-color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            color: var(--dark-blue);
        }

        /* Panel de ventas detalladas */
        .sales-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-size: 14px;
            color: var(--dark-blue);
            font-weight: 500;
        }

        .filter-select {
            padding: 10px 15px;
            border: 2px solid var(--gray-medium);
            border-radius: var(--radius-small);
            min-width: 150px;
        }

        .sales-summary {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
        }

        .summary-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--dark-blue);
            margin-bottom: 5px;
        }

        .summary-label {
            color: var(--gray-dark);
            font-size: 14px;
        }

        /* Reportes avanzados */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 30px;
        }

        .report-card {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
        }

        .profitability-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .metric-label {
            font-size: 14px;
            color: var(--gray-dark);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sale-container {
                flex-direction: column;
            }
            
            .cart-section {
                position: static;
            }
        }

        @media (max-width: 1024px) {
            .sidebar {
                width: 220px;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .owner-dashboard {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: static;
                padding: 15px 0;
            }
            
            .sidebar-menu {
                display: flex;
                overflow-x: auto;
            }
            
            .menu-item {
                white-space: nowrap;
                border-left: none;
                border-bottom: 4px solid transparent;
            }
            
            .menu-item:hover, .menu-item.active {
                border-left-color: transparent;
                border-bottom-color: var(--primary-blue);
            }
            
            .main-content {
                max-height: none;
            }
            
            .charts-container, .tables-container {
                grid-template-columns: 1fr;
            }
            
            .dashboard-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .payment-methods {
                flex-direction: column;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .barcode-btn {
                width: 100%;
                justify-content: center;
            }
            
            .employees-grid, .suppliers-grid, .debtors-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .login-card {
                padding: 30px 20px;
            }
            
            .header {
                padding: 15px 20px;
            }
            
            .employee-content, .main-content {
                padding: 20px;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .nav-item {
                min-width: 70px;
                padding: 8px 5px;
            }
            
            .nav-label {
                font-size: 12px;
            }
            
            .profitability-metrics {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Pantalla de Login -->
    <div class="login-container" id="login-container">
        <div class="login-card">
            <div class="logo-container">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="logo-text">La Eskina</div>
                </div>
                <div class="logo-subtitle">Sistema de Gestión del Kiosco</div>
            </div>
            
            <div class="user-type-selector">
                <button class="user-type-btn active" id="employee-btn">
                    <i class="fas fa-user-tie"></i> Empleado
                </button>
                <button class="user-type-btn" id="owner-btn">
                    <i class="fas fa-crown"></i> Dueño
                </button>
            </div>
            
            <form class="login-form" id="login-form">
                <div class="form-group">
                    <label for="username" class="form-label">Usuario</label>
                    <input type="text" id="username" class="form-input" placeholder="Ingresa tu usuario" required>
                </div>
                
                <div class="form-group">
                    <label for="password" class="form-label">Contraseña</label>
                    <input type="password" id="password" class="form-input" placeholder="Ingresa tu contraseña" required>
                </div>
                
                <button type="submit" class="login-btn" id="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Ingresar al Sistema
                </button>
            </form>
        </div>
    </div>
    
    <!-- Dashboard del Dueño -->
    <div class="dashboard-container" id="owner-dashboard">
        <header class="header">
            <div class="header-left">
                <div class="header-logo">La Eskina</div>
                <div class="user-info">
                    <div class="user-avatar">D</div>
                    <div class="user-name">Dueño Administrador</div>
                </div>
            </div>
            <button class="logout-btn" id="owner-logout">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
            </button>
        </header>
        
        <div class="owner-dashboard">
            <nav class="sidebar">
                <ul class="sidebar-menu">
                    <li class="menu-item active" data-section="dashboard">
                        <div class="menu-icon"><i class="fas fa-chart-line"></i></div>
                        <div>Dashboard</div>
                    </li>
                    <li class="menu-item" data-section="employees">
                        <div class="menu-icon"><i class="fas fa-users"></i></div>
                        <div>Empleados</div>
                    </li>
                    <li class="menu-item" data-section="stock">
                        <div class="menu-icon"><i class="fas fa-boxes"></i></div>
                        <div>Stock</div>
                    </li>
                    <li class="menu-item" data-section="suppliers">
                        <div class="menu-icon"><i class="fas fa-truck"></i></div>
                        <div>Proveedores</div>
                    </li>
                    <li class="menu-item" data-section="sales">
                        <div class="menu-icon"><i class="fas fa-cash-register"></i></div>
                        <div>Ventas</div>
                    </li>
                    <li class="menu-item" data-section="reports">
                        <div class="menu-icon"><i class="fas fa-chart-pie"></i></div>
                        <div>Reportes</div>
                    </li>
                </ul>
            </nav>
            
            <main class="main-content">
                <!-- Sección Dashboard -->
                <div class="dashboard-section" id="dashboard-section">
                    <h1 class="section-title"><i class="fas fa-chart-line"></i> Dashboard General</h1>
                    
                    <div class="dashboard-cards">
                        <div class="card">
                            <div class="card-title"><i class="fas fa-money-bill-wave"></i> Ventas Hoy</div>
                            <div class="card-value" id="sales-today">$0</div>
                            <div class="card-change positive"><i class="fas fa-arrow-up"></i> <span id="sales-change">0%</span> vs ayer</div>
                        </div>
                        <div class="card">
                            <div class="card-title"><i class="fas fa-shopping-cart"></i> Transacciones</div>
                            <div class="card-value" id="transactions-today">0</div>
                            <div class="card-change positive"><i class="fas fa-arrow-up"></i> <span id="transactions-change">0%</span> vs ayer</div>
                        </div>
                        <div class="card">
                            <div class="card-title"><i class="fas fa-box-open"></i> Productos Bajos</div>
                            <div class="card-value" id="low-stock-count">0</div>
                            <div class="card-change negative"><i class="fas fa-arrow-down"></i> Reabastecer</div>
                        </div>
                        <div class="card">
                            <div class="card-title"><i class="fas fa-user-clock"></i> Deudas Activas</div>
                            <div class="card-value" id="total-debts">$0</div>
                            <div class="card-change negative"><i class="fas fa-exclamation-circle"></i> <span id="debtors-count">0</span> clientes</div>
                        </div>
                    </div>
                    
                    <div class="charts-container">
                        <div class="chart-card">
                            <h2 class="chart-title">Ventas de la Semana</h2>
                            <div class="chart-container">
                                <canvas id="weeklySalesChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h2 class="chart-title">Productos Más Vendidos</h2>
                            <div class="chart-container">
                                <canvas id="topProductsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tables-container">
                        <div class="table-card">
                            <h2 class="table-title"><i class="fas fa-history"></i> Últimas Ventas</h2>
                            <table class="table" id="recent-sales-table">
                                <thead>
                                    <tr>
                                        <th>Hora</th>
                                        <th>Empleado</th>
                                        <th>Total</th>
                                        <th>Método</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Las ventas se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="table-card">
                            <h2 class="table-title"><i class="fas fa-exclamation-triangle"></i> Productos por Agotarse</h2>
                            <table class="table" id="low-stock-table">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Stock</th>
                                        <th>Mínimo</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Los productos se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Sección Empleados -->
                <div class="dashboard-section" id="employees-section" style="display: none;">
                    <div class="section-header">
                        <h1 class="section-title"><i class="fas fa-users"></i> Gestión de Empleados</h1>
                        <button class="add-btn" id="add-employee-btn">
                            <i class="fas fa-plus"></i> Agregar Empleado
                        </button>
                    </div>
                    
                    <div class="employees-grid" id="employees-grid">
                        <!-- Los empleados se cargarán dinámicamente -->
                    </div>
                </div>
                
                <!-- Sección Stock -->
                <div class="dashboard-section" id="stock-section" style="display: none;">
                    <div class="section-header">
                        <h1 class="section-title"><i class="fas fa-boxes"></i> Control de Stock</h1>
                        <button class="add-btn" id="add-stock-product-btn">
                            <i class="fas fa-plus"></i> Agregar Producto
                        </button>
                    </div>
                    
                    <div class="stock-table-container">
                        <table class="table stock-table">
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Producto</th>
                                    <th>Categoría</th>
                                    <th>Stock Actual</th>
                                    <th>Stock Mínimo</th>
                                    <th>Último Ingreso</th>
                                    <th>Proveedor</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="stock-table-body">
                                <!-- Los productos de stock se cargarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Sección Proveedores -->
                <div class="dashboard-section" id="suppliers-section" style="display: none;">
                    <div class="section-header">
                        <h1 class="section-title"><i class="fas fa-truck"></i> Proveedores</h1>
                        <button class="add-btn" id="add-supplier-btn">
                            <i class="fas fa-plus"></i> Agregar Proveedor
                        </button>
                    </div>
                    
                    <div class="suppliers-grid" id="suppliers-grid">
                        <!-- Los proveedores se cargarán dinámicamente -->
                    </div>
                </div>
                
                <!-- Sección Ventas -->
                <div class="dashboard-section" id="sales-section" style="display: none;">
                    <h1 class="section-title"><i class="fas fa-cash-register"></i> Ventas Detalladas</h1>
                    
                    <div class="sales-filters">
                        <div class="filter-group">
                            <label class="filter-label">Fecha Desde</label>
                            <input type="date" id="date-from" class="filter-select">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Fecha Hasta</label>
                            <input type="date" id="date-to" class="filter-select">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Empleado</label>
                            <select id="employee-filter" class="filter-select">
                                <option value="all">Todos</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Método de Pago</label>
                            <select id="payment-filter" class="filter-select">
                                <option value="all">Todos</option>
                                <option value="cash">Efectivo</option>
                                <option value="card">Tarjeta</option>
                                <option value="qr">QR</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="sales-summary">
                        <div class="summary-card">
                            <div class="summary-value" id="total-sales">$0</div>
                            <div class="summary-label">Total Ventas</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-value" id="total-transactions">0</div>
                            <div class="summary-label">Transacciones</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-value" id="avg-sale">$0</div>
                            <div class="summary-label">Ticket Promedio</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-value" id="best-day">-</div>
                            <div class="summary-label">Mejor Día</div>
                        </div>
                    </div>
                    
                    <div class="table-card">
                        <h2 class="table-title"><i class="fas fa-list"></i> Detalle de Ventas</h2>
                        <div style="overflow-x: auto;">
                            <table class="table" id="detailed-sales-table">
                                <thead>
                                    <tr>
                                        <th>Fecha/Hora</th>
                                        <th>Empleado</th>
                                        <th>Productos</th>
                                        <th>Cantidad</th>
                                        <th>Total</th>
                                        <th>Método</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Las ventas detalladas se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Sección Reportes -->
                <div class="dashboard-section" id="reports-section" style="display: none;">
                    <h1 class="section-title"><i class="fas fa-chart-pie"></i> Reportes Avanzados</h1>
                    
                    <div class="reports-grid">
                        <div class="report-card">
                            <h2 class="chart-title">Rentabilidad del Negocio</h2>
                            <div class="profitability-metrics">
                                <div class="metric">
                                    <div class="metric-value" id="profit-margin">0%</div>
                                    <div class="metric-label">Margen de Ganancia</div>
                                </div>
                                <div class="metric">
                                    <div class="metric-value" id="roi">0%</div>
                                    <div class="metric-label">ROI Mensual</div>
                                </div>
                                <div class="metric">
                                    <div class="metric-value" id="break-even">0 días</div>
                                    <div class="metric-label">Punto de Equilibrio</div>
                                </div>
                            </div>
                            <div class="chart-container" style="height: 250px; margin-top: 20px;">
                                <canvas id="profitabilityChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="report-card">
                            <h2 class="chart-title">Ventas por Categoría</h2>
                            <div class="chart-container" style="height: 350px;">
                                <canvas id="categorySalesChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="report-card">
                            <h2 class="chart-title">Tendencia de Ventas Mensual</h2>
                            <div class="chart-container" style="height: 350px;">
                                <canvas id="monthlyTrendChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="report-card">
                            <h2 class="chart-title">Eficiencia por Empleado</h2>
                            <div class="chart-container" style="height: 350px;">
                                <canvas id="employeeEfficiencyChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Dashboard del Empleado -->
    <div class="dashboard-container" id="employee-dashboard">
        <header class="employee-header">
            <div class="employee-header-logo">La Eskina - Modo Empleado</div>
            <div class="user-info">
                <div class="user-avatar">M</div>
                <div class="user-name" style="color: white;">María González</div>
            </div>
        </header>
        
        <main class="employee-content">
            <!-- Sección de Ventas Mejorada -->
            <div class="sale-section" id="sale-section">
                <div class="sale-header">
                    <h1 class="section-title"><i class="fas fa-cash-register"></i> Nueva Venta</h1>
                    <div class="search-container">
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" class="search-input" id="product-search" placeholder="Buscar producto por nombre o código...">
                        </div>
                        <button class="barcode-btn" id="scan-barcode-btn">
                            <i class="fas fa-barcode"></i> Escanear Código
                        </button>
                    </div>
                </div>
                
                <div class="sale-container">
                    <div class="products-section-emp">
                        <div class="products-grid" id="products-grid">
                            <!-- Productos se cargarán dinámicamente -->
                        </div>
                    </div>
                    
                    <div class="cart-section">
                        <div class="sale-cart">
                            <h2 class="cart-title"><i class="fas fa-shopping-cart"></i> Carrito de Venta</h2>
                            
                            <div class="cart-items" id="cart-items">
                                <!-- Items del carrito se cargarán dinámicamente -->
                                <div style="text-align: center; padding: 30px; color: var(--gray-dark);">
                                    <i class="fas fa-shopping-cart" style="font-size: 48px; margin-bottom: 15px;"></i>
                                    <p>No hay productos en el carrito</p>
                                </div>
                            </div>
                            
                            <div class="cart-total">
                                <span>Total:</span>
                                <span id="cart-total">$0</span>
                            </div>
                            
                            <h3 style="margin: 20px 0 15px 0; color: var(--dark-blue);">Método de Pago</h3>
                            <div class="payment-methods">
                                <div class="payment-method active" data-method="cash">
                                    <i class="fas fa-money-bill-wave payment-icon"></i>
                                    <span class="payment-label">Efectivo</span>
                                </div>
                                <div class="payment-method" data-method="card">
                                    <i class="fas fa-credit-card payment-icon"></i>
                                    <span class="payment-label">Tarjeta</span>
                                </div>
                                <div class="payment-method" data-method="qr">
                                    <i class="fas fa-qrcode payment-icon"></i>
                                    <span class="payment-label">QR</span>
                                </div>
                            </div>
                            
                            <button class="complete-sale-btn" id="complete-sale">
                                <i class="fas fa-check-circle"></i> COMPLETAR VENTA
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Historial de ventas del día -->
                <div class="sales-history">
                    <h2 class="sales-history-title"><i class="fas fa-history"></i> Ventas de Hoy</h2>
                    <div class="sales-list" id="daily-sales-list">
                        <!-- Las ventas del día se cargarán dinámicamente -->
                        <div style="text-align: center; padding: 30px; color: var(--gray-dark);">
                            <i class="fas fa-receipt" style="font-size: 48px; margin-bottom: 15px;"></i>
                            <p>No hay ventas registradas hoy</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sección de Productos -->
            <div class="products-section" id="products-section">
                <div class="section-header">
                    <h1 class="section-title"><i class="fas fa-boxes"></i> Gestión de Productos</h1>
                    <button class="add-btn" id="add-product-btn">
                        <i class="fas fa-plus"></i> Agregar Producto
                    </button>
                </div>
                
                <div class="products-grid" id="employee-products-grid">
                    <!-- Los productos se cargarán dinámicamente -->
                </div>
            </div>
            
            <!-- Sección de Deudores Mejorada -->
            <div class="debtors-section" id="debtors-section">
                <div class="section-header">
                    <h1 class="section-title"><i class="fas fa-user-clock"></i> Clientes con Deuda</h1>
                    <button class="add-btn" id="add-debtor-btn">
                        <i class="fas fa-plus"></i> Agregar Deudor
                    </button>
                </div>
                
                <div class="debtors-grid" id="debtors-grid">
                    <!-- Los deudores se cargarán dinámicamente -->
                </div>
            </div>
        </main>
        
        <!-- Menú inferior del empleado -->
        <nav class="bottom-nav">
            <div class="nav-item active" data-section="sale">
                <i class="fas fa-cash-register nav-icon"></i>
                <span class="nav-label">Venta</span>
            </div>
            <div class="nav-item" data-section="products">
                <i class="fas fa-boxes nav-icon"></i>
                <span class="nav-label">Productos</span>
            </div>
            <div class="nav-item" data-section="debtors">
                <i class="fas fa-user-clock nav-icon"></i>
                <span class="nav-label">Deudores</span>
            </div>
        </nav>
    </div>
    
    <!-- Modal para agregar producto -->
    <div class="modal" id="product-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Agregar Producto</h2>
                <button class="close-modal" id="close-product-modal">&times;</button>
            </div>
            <form id="product-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="product-name" class="form-label">Nombre del Producto *</label>
                        <input type="text" id="product-name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="product-code" class="form-label">Código de Barras *</label>
                        <input type="text" id="product-code" class="form-input" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="product-price" class="form-label">Precio de Venta *</label>
                        <input type="number" id="product-price" class="form-input" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="product-cost" class="form-label">Costo *</label>
                        <input type="number" id="product-cost" class="form-input" step="0.01" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="product-stock" class="form-label">Stock Inicial *</label>
                        <input type="number" id="product-stock" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="product-min-stock" class="form-label">Stock Mínimo</label>
                        <input type="number" id="product-min-stock" class="form-input" value="5">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="product-category" class="form-label">Categoría *</label>
                        <select id="product-category" class="form-input" required>
                            <option value="bebidas">Bebidas</option>
                            <option value="snacks">Snacks</option>
                            <option value="lacteos">Lácteos</option>
                            <option value="panaderia">Panadería</option>
                            <option value="limpieza">Limpieza</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="product-supplier" class="form-label">Proveedor</label>
                        <select id="product-supplier" class="form-input">
                            <option value="">Sin proveedor</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="login-btn">Guardar Producto</button>
            </form>
        </div>
    </div>
    
    <!-- Modal para agregar deudor -->
    <div class="modal" id="debtor-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Agregar Cliente con Deuda</h2>
                <button class="close-modal" id="close-debtor-modal">&times;</button>
            </div>
            <form id="debtor-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="debtor-name" class="form-label">Nombre del Cliente *</label>
                        <input type="text" id="debtor-name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="debtor-phone" class="form-label">Teléfono *</label>
                        <input type="tel" id="debtor-phone" class="form-input" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="debtor-amount" class="form-label">Monto Adeudado *</label>
                        <input type="number" id="debtor-amount" class="form-input" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="debtor-duedate" class="form-label">Fecha de Vencimiento</label>
                        <input type="date" id="debtor-duedate" class="form-input">
                    </div>
                </div>
                <div class="form-group">
                    <label for="debtor-notes" class="form-label">Notas</label>
                    <textarea id="debtor-notes" class="form-input" rows="3"></textarea>
                </div>
                <button type="submit" class="login-btn">Registrar Deuda</button>
            </form>
        </div>
    </div>
    
    <!-- Modal para agregar/editar empleado -->
    <div class="modal" id="employee-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="employee-modal-title">Agregar Empleado</h2>
                <button class="close-modal" id="close-employee-modal">&times;</button>
            </div>
            <form id="employee-form">
                <input type="hidden" id="employee-id">
                <div class="form-row">
                    <div class="form-group">
                        <label for="employee-name" class="form-label">Nombre *</label>
                        <input type="text" id="employee-name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="employee-lastname" class="form-label">Apellido *</label>
                        <input type="text" id="employee-lastname" class="form-input" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="employee-email" class="form-label">Email</label>
                        <input type="email" id="employee-email" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="employee-phone" class="form-label">Teléfono *</label>
                        <input type="tel" id="employee-phone" class="form-input" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="employee-salary" class="form-label">Sueldo Mensual *</label>
                        <input type="number" id="employee-salary" class="form-input" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="employee-position" class="form-label">Puesto *</label>
                        <select id="employee-position" class="form-input" required>
                            <option value="cajero">Cajero</option>
                            <option value="repositor">Repositor</option>
                            <option value="supervisor">Supervisor</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Días de Trabajo *</label>
                    <div class="schedule-days" id="work-days-selector">
                        <!-- Los días se generarán dinámicamente -->
                    </div>
                </div>
                <button type="submit" class="login-btn">Guardar Empleado</button>
            </form>
        </div>
    </div>
    
    <!-- Modal para agregar/editar proveedor -->
    <div class="modal" id="supplier-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="supplier-modal-title">Agregar Proveedor</h2>
                <button class="close-modal" id="close-supplier-modal">&times;</button>
            </div>
            <form id="supplier-form">
                <input type="hidden" id="supplier-id">
                <div class="form-row">
                    <div class="form-group">
                        <label for="supplier-name" class="form-label">Nombre *</label>
                        <input type="text" id="supplier-name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="supplier-contact" class="form-label">Contacto *</label>
                        <input type="text" id="supplier-contact" class="form-input" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="supplier-phone" class="form-label">Teléfono *</label>
                        <input type="tel" id="supplier-phone" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="supplier-email" class="form-label">Email</label>
                        <input type="email" id="supplier-email" class="form-input">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="supplier-address" class="form-label">Dirección</label>
                        <input type="text" id="supplier-address" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="supplier-category" class="form-label">Categoría de Productos *</label>
                        <select id="supplier-category" class="form-input" required multiple>
                            <option value="bebidas">Bebidas</option>
                            <option value="snacks">Snacks</option>
                            <option value="lacteos">Lácteos</option>
                            <option value="panaderia">Panadería</option>
                            <option value="limpieza">Limpieza</option>
                            <option value="otros">Otros</option>
                        </select>
                        <small>Mantén presionada la tecla Ctrl para seleccionar múltiples opciones</small>
                    </div>
                </div>
                <div class="form-group">
                    <label for="supplier-notes" class="form-label">Notas</label>
                    <textarea id="supplier-notes" class="form-input" rows="3"></textarea>
                </div>
                <button type="submit" class="login-btn">Guardar Proveedor</button>
            </form>
        </div>
    </div>
    
    <!-- Modal para escanear código de barras -->
    <div class="modal" id="barcode-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Escanear Código de Barras</h2>
                <button class="close-modal" id="close-barcode-modal">&times;</button>
            </div>
            <div style="text-align: center; padding: 30px;">
                <div style="width: 300px; height: 200px; background-color: var(--gray-light); border-radius: var(--radius); margin: 0 auto 30px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-barcode" style="font-size: 80px; color: var(--gray-dark);"></i>
                </div>
                <p style="margin-bottom: 20px; color: var(--gray-dark);">Simulación de escáner de código de barras</p>
                <div class="form-group">
                    <label for="manual-barcode" class="form-label">Ingresar código manualmente:</label>
                    <input type="text" id="manual-barcode" class="form-input" placeholder="Ej: 7791234567890" style="text-align: center;">
                </div>
                <button class="login-btn" id="simulate-scan" style="margin-top: 20px;">
                    <i class="fas fa-camera"></i> Simular Escaneo
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== SISTEMA COMPLETO DE GESTIÓN =====
        // Datos de ejemplo con persistencia en localStorage
        const AppData = {
            // Inicializar datos si no existen
            init: function() {
                if (!localStorage.getItem('eskina_products')) {
                    const initialProducts = [
                        { id: 1, code: "7791234567890", name: "Coca-Cola 2L", price: 850, cost: 520, stock: 8, minStock: 5, category: "bebidas", supplierId: 1, icon: "fas fa-wine-bottle", salesCount: 45 },
                        { id: 2, code: "7791234567891", name: "Papas Lays", price: 520, cost: 320, stock: 15, minStock: 10, category: "snacks", supplierId: 2, icon: "fas fa-cookie", salesCount: 78 },
                        { id: 3, code: "7791234567892", name: "Leche Entera", price: 680, cost: 450, stock: 12, minStock: 8, category: "lacteos", supplierId: 3, icon: "fas fa-wine-bottle", salesCount: 32 },
                        { id: 4, code: "7791234567893", name: "Pan Bimbo", price: 450, cost: 280, stock: 5, minStock: 10, category: "panaderia", supplierId: 4, icon: "fas fa-bread-slice", salesCount: 56 },
                        { id: 5, code: "7791234567894", name: "Arroz 1kg", price: 620, cost: 380, stock: 9, minStock: 15, category: "otros", supplierId: null, icon: "fas fa-weight", salesCount: 23 },
                        { id: 6, code: "7791234567895", name: "Huevos (30u)", price: 1250, cost: 850, stock: 4, minStock: 12, category: "otros", supplierId: null, icon: "fas fa-egg", salesCount: 41 },
                        { id: 7, code: "7791234567896", name: "Galletas Oreo", price: 380, cost: 220, stock: 22, minStock: 15, category: "snacks", supplierId: 2, icon: "fas fa-cookie", salesCount: 67 },
                        { id: 8, code: "7791234567897", name: "Agua 1.5L", price: 420, cost: 250, stock: 18, minStock: 12, category: "bebidas", supplierId: 1, icon: "fas fa-wine-bottle", salesCount: 89 },
                        { id: 9, code: "7791234567898", name: "Yogur", price: 320, cost: 180, stock: 14, minStock: 10, category: "lacteos", supplierId: 3, icon: "fas fa-wine-bottle", salesCount: 34 },
                        { id: 10, code: "7791234567899", name: "Jabón Líquido", price: 750, cost: 450, stock: 7, minStock: 5, category: "limpieza", supplierId: null, icon: "fas fa-pump-soap", salesCount: 12 }
                    ];
                    localStorage.setItem('eskina_products', JSON.stringify(initialProducts));
                }
                
                if (!localStorage.getItem('eskina_sales')) {
                    // Crear ventas de ejemplo para los últimos 30 días
                    const sales = [];
                    const employees = ['María González', 'Carlos López', 'Ana Rodríguez'];
                    const methods = ['cash', 'card', 'qr'];
                    const products = JSON.parse(localStorage.getItem('eskina_products'));
                    
                    for (let i = 0; i < 50; i++) {
                        const saleDate = new Date();
                        saleDate.setDate(saleDate.getDate() - Math.floor(Math.random() * 30));
                        saleDate.setHours(8 + Math.floor(Math.random() * 10));
                        saleDate.setMinutes(Math.floor(Math.random() * 60));
                        
                        const productCount = Math.floor(Math.random() * 5) + 1;
                        const saleProducts = [];
                        let total = 0;
                        
                        for (let j = 0; j < productCount; j++) {
                            const product = products[Math.floor(Math.random() * products.length)];
                            const quantity = Math.floor(Math.random() * 3) + 1;
                            saleProducts.push({
                                productId: product.id,
                                name: product.name,
                                quantity: quantity,
                                price: product.price
                            });
                            total += product.price * quantity;
                        }
                        
                        sales.push({
                            id: i + 1,
                            date: saleDate.toISOString(),
                            employee: employees[Math.floor(Math.random() * employees.length)],
                            products: saleProducts,
                            total: total,
                            method: methods[Math.floor(Math.random() * methods.length)],
                            completed: true
                        });
                    }
                    localStorage.setItem('eskina_sales', JSON.stringify(sales));
                }
                
                if (!localStorage.getItem('eskina_employees')) {
                    const initialEmployees = [
                        { 
                            id: 1, 
                            name: "María", 
                            lastName: "González", 
                            email: "maria@laeskina.com", 
                            phone: "351-1234567", 
                            salary: 180000, 
                            position: "cajero",
                            workDays: [1, 2, 3, 4, 5], // Lunes a Viernes
                            hireDate: "2023-01-15",
                            salesCount: 245,
                            totalSales: 185000
                        },
                        { 
                            id: 2, 
                            name: "Carlos", 
                            lastName: "López", 
                            email: "carlos@laeskina.com", 
                            phone: "351-7654321", 
                            salary: 190000, 
                            position: "supervisor",
                            workDays: [1, 2, 3, 4, 5, 6], // Lunes a Sábado
                            hireDate: "2022-08-10",
                            salesCount: 312,
                            totalSales: 245000
                        },
                        { 
                            id: 3, 
                            name: "Ana", 
                            lastName: "Rodríguez", 
                            email: "ana@laeskina.com", 
                            phone: "351-9876543", 
                            salary: 175000, 
                            position: "repositor",
                            workDays: [2, 3, 4, 5, 6], // Martes a Sábado
                            hireDate: "2023-03-20",
                            salesCount: 189,
                            totalSales: 152000
                        }
                    ];
                    localStorage.setItem('eskina_employees', JSON.stringify(initialEmployees));
                }
                
                if (!localStorage.getItem('eskina_suppliers')) {
                    const initialSuppliers = [
                        {
                            id: 1,
                            name: "Distribuidora de Bebidas S.A.",
                            contact: "Juan Pérez",
                            phone: "351-1112233",
                            email: "ventas@bebidassa.com",
                            address: "Av. Siempre Viva 123",
                            categories: ["bebidas"],
                            products: [1, 8],
                            lastOrder: "2023-10-15",
                            status: "active",
                            notes: "Paga a 30 días"
                        },
                        {
                            id: 2,
                            name: "Snacks y Golosinas SRL",
                            contact: "María García",
                            phone: "351-2223344",
                            email: "contacto@snacks.com",
                            address: "Calle Falsa 456",
                            categories: ["snacks"],
                            products: [2, 7],
                            lastOrder: "2023-10-18",
                            status: "active",
                            notes: "Descuento por volumen"
                        },
                        {
                            id: 3,
                            name: "Lácteos del Valle",
                            contact: "Roberto Martínez",
                            phone: "351-3334455",
                            email: "roberto@lacteos.com",
                            address: "Ruta 9 km 123",
                            categories: ["lacteos"],
                            products: [3, 9],
                            lastOrder: "2023-10-20",
                            status: "active",
                            notes: "Entrega los martes y jueves"
                        },
                        {
                            id: 4,
                            name: "Panadería La Espiga",
                            contact: "Lucía Fernández",
                            phone: "351-4445566",
                            email: "lucia@panaderia.com",
                            address: "Bv. San Juan 789",
                            categories: ["panaderia"],
                            products: [4],
                            lastOrder: "2023-10-22",
                            status: "active",
                            notes: "Entrega diaria a las 6 AM"
                        }
                    ];
                    localStorage.setItem('eskina_suppliers', JSON.stringify(initialSuppliers));
                }
                
                if (!localStorage.getItem('eskina_debtors')) {
                    const initialDebtors = [
                        {
                            id: 1,
                            name: "Juan Pérez",
                            phone: "351-1234567",
                            amount: 2500,
                            date: "2023-10-15",
                            dueDate: "2023-10-30",
                            notes: "Cliente frecuente, paga a fin de mes",
                            status: "pending"
                        },
                        {
                            id: 2,
                            name: "Ana Rodríguez",
                            phone: "351-7654321",
                            amount: 1200,
                            date: "2023-10-12",
                            dueDate: "2023-10-25",
                            notes: "Vecina de la cuadra",
                            status: "pending"
                        },
                        {
                            id: 3,
                            name: "Luis Gómez",
                            phone: "351-9876543",
                            amount: 3500,
                            date: "2023-10-10",
                            dueDate: "2023-11-10",
                            notes: "Deja prenda como garantía",
                            status: "partial"
                        }
                    ];
                    localStorage.setItem('eskina_debtors', JSON.stringify(initialDebtors));
                }
                
                if (!localStorage.getItem('eskina_daily_sales')) {
                    localStorage.setItem('eskina_daily_sales', JSON.stringify([]));
                }
                
                if (!localStorage.getItem('eskina_stock_movements')) {
                    localStorage.setItem('eskina_stock_movements', JSON.stringify([]));
                }
            },
            
            // Obtener datos
            getProducts: function() {
                return JSON.parse(localStorage.getItem('eskina_products')) || [];
            },
            
            getSales: function() {
                return JSON.parse(localStorage.getItem('eskina_sales')) || [];
            },
            
            getEmployees: function() {
                return JSON.parse(localStorage.getItem('eskina_employees')) || [];
            },
            
            getSuppliers: function() {
                return JSON.parse(localStorage.getItem('eskina_suppliers')) || [];
            },
            
            getDebtors: function() {
                return JSON.parse(localStorage.getItem('eskina_debtors')) || [];
            },
            
            getDailySales: function() {
                return JSON.parse(localStorage.getItem('eskina_daily_sales')) || [];
            },
            
            getStockMovements: function() {
                return JSON.parse(localStorage.getItem('eskina_stock_movements')) || [];
            },
            
            // Guardar datos
            saveProducts: function(products) {
                localStorage.setItem('eskina_products', JSON.stringify(products));
            },
            
            saveSales: function(sales) {
                localStorage.setItem('eskina_sales', JSON.stringify(sales));
            },
            
            saveEmployees: function(employees) {
                localStorage.setItem('eskina_employees', JSON.stringify(employees));
            },
            
            saveSuppliers: function(suppliers) {
                localStorage.setItem('eskina_suppliers', JSON.stringify(suppliers));
            },
            
            saveDebtors: function(debtors) {
                localStorage.setItem('eskina_debtors', JSON.stringify(debtors));
            },
            
            saveDailySales: function(dailySales) {
                localStorage.setItem('eskina_daily_sales', JSON.stringify(dailySales));
            },
            
            saveStockMovements: function(movements) {
                localStorage.setItem('eskina_stock_movements', JSON.stringify(movements));
            },
            
            // Métodos auxiliares
            getProductById: function(id) {
                const products = this.getProducts();
                return products.find(p => p.id === id);
            },
            
            getSupplierById: function(id) {
                const suppliers = this.getSuppliers();
                return suppliers.find(s => s.id === id);
            },
            
            getEmployeeByName: function(name) {
                const employees = this.getEmployees();
                return employees.find(e => `${e.name} ${e.lastName}` === name);
            },
            
            addSale: function(sale) {
                const sales = this.getSales();
                sale.id = sales.length > 0 ? Math.max(...sales.map(s => s.id)) + 1 : 1;
                sales.push(sale);
                this.saveSales(sales);
                
                // Actualizar contadores de ventas de productos
                const products = this.getProducts();
                sale.products.forEach(sp => {
                    const product = products.find(p => p.id === sp.productId);
                    if (product) {
                        if (!product.salesCount) product.salesCount = 0;
                        product.salesCount += sp.quantity;
                    }
                });
                this.saveProducts(products);
                
                // Agregar a ventas diarias
                const dailySales = this.getDailySales();
                const today = new Date().toISOString().split('T')[0];
                const todaySale = dailySales.find(ds => ds.date === today);
                
                if (todaySale) {
                    todaySale.total += sale.total;
                    todaySale.count += 1;
                } else {
                    dailySales.push({
                        date: today,
                        total: sale.total,
                        count: 1
                    });
                }
                this.saveDailySales(dailySales);
                
                return sale;
            },
            
            addProduct: function(product) {
                const products = this.getProducts();
                product.id = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                product.salesCount = 0;
                products.push(product);
                this.saveProducts(products);
                return product;
            },
            
            updateProduct: function(id, updates) {
                const products = this.getProducts();
                const index = products.findIndex(p => p.id === id);
                if (index !== -1) {
                    products[index] = {...products[index], ...updates};
                    this.saveProducts(products);
                    return products[index];
                }
                return null;
            },
            
            updateStock: function(productId, quantity, type = 'add', reason = '') {
                const products = this.getProducts();
                const product = products.find(p => p.id === productId);
                
                if (!product) return false;
                
                if (type === 'add') {
                    product.stock += quantity;
                } else if (type === 'remove') {
                    product.stock -= quantity;
                    if (product.stock < 0) product.stock = 0;
                } else if (type === 'set') {
                    product.stock = quantity;
                }
                
                this.saveProducts(products);
                
                // Registrar movimiento de stock
                const movements = this.getStockMovements();
                movements.push({
                    id: movements.length + 1,
                    date: new Date().toISOString(),
                    productId: productId,
                    productName: product.name,
                    quantity: quantity,
                    type: type,
                    reason: reason,
                    newStock: product.stock
                });
                this.saveStockMovements(movements);
                
                return true;
            },
            
            addEmployee: function(employee) {
                const employees = this.getEmployees();
                employee.id = employees.length > 0 ? Math.max(...employees.map(e => e.id)) + 1 : 1;
                employee.salesCount = 0;
                employee.totalSales = 0;
                employee.hireDate = employee.hireDate || new Date().toISOString().split('T')[0];
                employees.push(employee);
                this.saveEmployees(employees);
                return employee;
            },
            
            updateEmployee: function(id, updates) {
                const employees = this.getEmployees();
                const index = employees.findIndex(e => e.id === id);
                if (index !== -1) {
                    employees[index] = {...employees[index], ...updates};
                    this.saveEmployees(employees);
                    return employees[index];
                }
                return null;
            },
            
            addSupplier: function(supplier) {
                const suppliers = this.getSuppliers();
                supplier.id = suppliers.length > 0 ? Math.max(...suppliers.map(s => s.id)) + 1 : 1;
                supplier.status = supplier.status || 'active';
                suppliers.push(supplier);
                this.saveSuppliers(suppliers);
                return supplier;
            },
            
            updateSupplier: function(id, updates) {
                const suppliers = this.getSuppliers();
                const index = suppliers.findIndex(s => s.id === id);
                if (index !== -1) {
                    suppliers[index] = {...suppliers[index], ...updates};
                    this.saveSuppliers(suppliers);
                    return suppliers[index];
                }
                return null;
            },
            
            addDebtor: function(debtor) {
                const debtors = this.getDebtors();
                debtor.id = debtors.length > 0 ? Math.max(...debtors.map(d => d.id)) + 1 : 1;
                debtor.status = 'pending';
                debtor.date = debtor.date || new Date().toISOString().split('T')[0];
                debtors.push(debtor);
                this.saveDebtors(debtors);
                return debtor;
            },
            
            updateDebtor: function(id, updates) {
                const debtors = this.getDebtors();
                const index = debtors.findIndex(d => d.id === id);
                if (index !== -1) {
                    debtors[index] = {...debtors[index], ...updates};
                    this.saveDebtors(debtors);
                    return debtors[index];
                }
                return null;
            },
            
            deleteDebtor: function(id) {
                const debtors = this.getDebtors();
                const filtered = debtors.filter(d => d.id !== id);
                this.saveDebtors(filtered);
                return true;
            },
            
            // Métricas y estadísticas
            getTodaySales: function() {
                const today = new Date().toISOString().split('T')[0];
                const sales = this.getSales();
                const todaySales = sales.filter(s => s.date.split('T')[0] === today);
                return {
                    total: todaySales.reduce((sum, s) => sum + s.total, 0),
                    count: todaySales.length
                };
            },
            
            getLowStockProducts: function() {
                const products = this.getProducts();
                return products.filter(p => p.stock <= p.minStock);
            },
            
            getTotalDebts: function() {
                const debtors = this.getDebtors();
                return debtors.reduce((sum, d) => sum + d.amount, 0);
            },
            
            getWeeklySalesData: function() {
                const sales = this.getSales();
                const last7Days = [...Array(7)].map((_, i) => {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    return date.toISOString().split('T')[0];
                }).reverse();
                
                const dailyTotals = last7Days.map(date => {
                    const daySales = sales.filter(s => s.date.split('T')[0] === date);
                    return daySales.reduce((sum, s) => sum + s.total, 0);
                });
                
                return {
                    labels: last7Days.map(d => new Date(d).toLocaleDateString('es-AR', { weekday: 'short' })),
                    data: dailyTotals
                };
            },
            
            getTopProducts: function(limit = 5) {
                const products = this.getProducts();
                return [...products]
                    .sort((a, b) => (b.salesCount || 0) - (a.salesCount || 0))
                    .slice(0, limit);
            },
            
            getSalesByCategory: function() {
                const products = this.getProducts();
                const sales = this.getSales();
                
                const categorySales = {};
                products.forEach(p => {
                    if (!categorySales[p.category]) {
                        categorySales[p.category] = 0;
                    }
                });
                
                sales.forEach(s => {
                    s.products.forEach(sp => {
                        const product = products.find(p => p.id === sp.productId);
                        if (product && categorySales[product.category] !== undefined) {
                            categorySales[product.category] += sp.price * sp.quantity;
                        }
                    });
                });
                
                return {
                    labels: Object.keys(categorySales).map(cat => {
                        const names = {
                            'bebidas': 'Bebidas',
                            'snacks': 'Snacks',
                            'lacteos': 'Lácteos',
                            'panaderia': 'Panadería',
                            'limpieza': 'Limpieza',
                            'otros': 'Otros'
                        };
                        return names[cat] || cat;
                    }),
                    data: Object.values(categorySales)
                };
            },
            
            getMonthlyTrend: function() {
                const sales = this.getSales();
                const last6Months = [...Array(6)].map((_, i) => {
                    const date = new Date();
                    date.setMonth(date.getMonth() - i);
                    return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                }).reverse();
                
                const monthlyTotals = last6Months.map(month => {
                    const monthSales = sales.filter(s => s.date.startsWith(month));
                    return monthSales.reduce((sum, s) => sum + s.total, 0);
                });
                
                return {
                    labels: last6Months.map(m => {
                        const [year, month] = m.split('-');
                        return `${month}/${year.slice(2)}`;
                    }),
                    data: monthlyTotals
                };
            },
            
            getEmployeeEfficiency: function() {
                const employees = this.getEmployees();
                const sales = this.getSales();
                
                return employees.map(emp => {
                    const empName = `${emp.name} ${emp.lastName}`;
                    const empSales = sales.filter(s => s.employee === empName);
                    const totalSales = empSales.reduce((sum, s) => sum + s.total, 0);
                    const avgSale = empSales.length > 0 ? totalSales / empSales.length : 0;
                    
                    return {
                        name: emp.name,
                        salesCount: empSales.length,
                        totalSales: totalSales,
                        avgSale: avgSale,
                        efficiency: empSales.length > 0 ? Math.min(100, (totalSales / 50000) * 100) : 0 // Eficiencia basada en ventas
                    };
                });
            },
            
            getProfitabilityData: function() {
                const products = this.getProducts();
                const sales = this.getSales();
                
                let totalRevenue = 0;
                let totalCost = 0;
                
                sales.forEach(s => {
                    s.products.forEach(sp => {
                        const product = products.find(p => p.id === sp.productId);
                        if (product) {
                            totalRevenue += sp.price * sp.quantity;
                            totalCost += product.cost * sp.quantity;
                        }
                    });
                });
                
                const grossProfit = totalRevenue - totalCost;
                const profitMargin = totalRevenue > 0 ? (grossProfit / totalRevenue) * 100 : 0;
                const roi = totalCost > 0 ? (grossProfit / totalCost) * 100 : 0;
                
                // Estimación de costos fijos (alquiler, servicios, sueldos)
                const fixedCosts = 150000; // Estimado mensual
                const breakEvenDays = grossProfit > 0 ? Math.ceil(fixedCosts / (grossProfit / 30)) : 0;
                
                return {
                    revenue: totalRevenue,
                    cost: totalCost,
                    grossProfit: grossProfit,
                    profitMargin: profitMargin,
                    roi: roi,
                    breakEvenDays: breakEvenDays,
                    data: [
                        { label: 'Costo', value: totalCost },
                        { label: 'Ganancia', value: grossProfit }
                    ]
                };
            }
        };

        // ===== SISTEMA DE VENTAS DEL EMPLEADO =====
        let cart = [];
        let currentPaymentMethod = 'cash';
        let dailySales = [];
        let isEmployeeMode = true;

        // DOM Elements
        const loginContainer = document.getElementById('login-container');
        const ownerDashboard = document.getElementById('owner-dashboard');
        const employeeDashboard = document.getElementById('employee-dashboard');
        const employeeBtn = document.getElementById('employee-btn');
        const ownerBtn = document.getElementById('owner-btn');
        const loginForm = document.getElementById('login-form');
        const ownerLogoutBtn = document.getElementById('owner-logout');
        const productsGrid = document.getElementById('products-grid');
        const cartItems = document.getElementById('cart-items');
        const cartTotal = document.getElementById('cart-total');
        const completeSaleBtn = document.getElementById('complete-sale');
        const paymentMethods = document.querySelectorAll('.payment-method');
        const bottomNavItems = document.querySelectorAll('.nav-item');
        const menuItems = document.querySelectorAll('.menu-item');
        const dashboardSections = document.querySelectorAll('.dashboard-section');
        const addProductBtn = document.getElementById('add-product-btn');
        const addDebtorBtn = document.getElementById('add-debtor-btn');
        const productModal = document.getElementById('product-modal');
        const debtorModal = document.getElementById('debtor-modal');
        const employeeModal = document.getElementById('employee-modal');
        const supplierModal = document.getElementById('supplier-modal');
        const barcodeModal = document.getElementById('barcode-modal');
        const closeProductModal = document.getElementById('close-product-modal');
        const closeDebtorModal = document.getElementById('close-debtor-modal');
        const closeEmployeeModal = document.getElementById('close-employee-modal');
        const closeSupplierModal = document.getElementById('close-supplier-modal');
        const closeBarcodeModal = document.getElementById('close-barcode-modal');
        const productForm = document.getElementById('product-form');
        const debtorForm = document.getElementById('debtor-form');
        const employeeForm = document.getElementById('employee-form');
        const supplierForm = document.getElementById('supplier-form');
        const productSearch = document.getElementById('product-search');
        const scanBarcodeBtn = document.getElementById('scan-barcode-btn');
        const simulateScanBtn = document.getElementById('simulate-scan');
        const manualBarcodeInput = document.getElementById('manual-barcode');
        const addEmployeeBtn = document.getElementById('add-employee-btn');
        const addStockProductBtn = document.getElementById('add-stock-product-btn');
        const addSupplierBtn = document.getElementById('add-supplier-btn');
        const employeeProductsGrid = document.getElementById('employee-products-grid');
        const debtorsGrid = document.getElementById('debtors-grid');
        const employeesGrid = document.getElementById('employees-grid');
        const stockTableBody = document.getElementById('stock-table-body');
        const suppliersGrid = document.getElementById('suppliers-grid');
        const recentSalesTable = document.getElementById('recent-sales-table');
        const lowStockTable = document.getElementById('low-stock-table');
        const detailedSalesTable = document.getElementById('detailed-sales-table');
        const dailySalesList = document.getElementById('daily-sales-list');

        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar datos
            AppData.init();
            
            // Cargar datos iniciales
            loadInitialData();
            
            // Establecer eventos
            setupEventListeners();
            
            // Inicializar gráficos del dueño
            initCharts();
        });

        function loadInitialData() {
            // Cargar productos en la grilla del empleado
            renderProducts();
            
            // Cargar productos en la sección de productos del empleado
            renderEmployeeProducts();
            
            // Cargar deudores
            renderDebtors();
            
            // Cargar empleados
            renderEmployees();
            
            // Cargar stock
            renderStockTable();
            
            // Cargar proveedores
            renderSuppliers();
            
            // Cargar ventas del día
            renderDailySales();
            
            // Cargar ventas recientes en dashboard del dueño
            renderRecentSales();
            
            // Cargar productos bajos en stock
            renderLowStockProducts();
            
            // Actualizar métricas del dashboard
            updateDashboardMetrics();
            
            // Cargar ventas detalladas
            renderDetailedSales();
            
            // Cargar opciones de empleados en filtros
            populateEmployeeFilter();
        }

        function setupEventListeners() {
            // Selector de tipo de usuario en login
            employeeBtn.addEventListener('click', function() {
                employeeBtn.classList.add('active');
                ownerBtn.classList.remove('active');
                isEmployeeMode = true;
            });
            
            ownerBtn.addEventListener('click', function() {
                ownerBtn.classList.add('active');
                employeeBtn.classList.remove('active');
                isEmployeeMode = false;
            });

            // Login
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // Validación simple
                if (username && password) {
                    const isOwner = ownerBtn.classList.contains('active');
                    
                    if (isOwner) {
                        // Login como dueño (credenciales simuladas: admin/admin123)
                        if (username === 'admin' && password === 'admin123') {
                            loginContainer.style.display = 'none';
                            ownerDashboard.style.display = 'block';
                            updateDashboardMetrics();
                            initCharts();
                        } else {
                            alert('Credenciales incorrectas. Use admin/admin123 para dueño.');
                        }
                    } else {
                        // Login como empleado (cualquier credencial funciona en demo)
                        loginContainer.style.display = 'none';
                        employeeDashboard.style.display = 'block';
                        
                        // Actualizar nombre del empleado en pantalla
                        const employeeName = username.charAt(0).toUpperCase() + username.slice(1);
                        document.querySelector('.employee-dashboard .user-name').textContent = employeeName;
                        
                        // Cargar ventas del día
                        renderDailySales();
                    }
                } else {
                    alert('Por favor completa todos los campos');
                }
            });

            // Logout del dueño
            ownerLogoutBtn.addEventListener('click', function() {
                ownerDashboard.style.display = 'none';
                loginContainer.style.display = 'flex';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            });

            // Logout del empleado (simulado)
            document.addEventListener('click', function(e) {
                if (e.target.closest('.user-avatar') && employeeDashboard.style.display === 'block') {
                    if (confirm('¿Deseas cerrar sesión?')) {
                        employeeDashboard.style.display = 'none';
                        loginContainer.style.display = 'flex';
                        document.getElementById('username').value = '';
                        document.getElementById('password').value = '';
                        cart = [];
                        renderCart();
                    }
                }
            });

            // Menú del dueño
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    
                    // Remover clase active de todos los items
                    menuItems.forEach(i => i.classList.remove('active'));
                    // Agregar clase active al item clickeado
                    this.classList.add('active');
                    
                    // Ocultar todas las secciones
                    dashboardSections.forEach(s => s.style.display = 'none');
                    
                    // Mostrar la sección correspondiente
                    document.getElementById(`${section}-section`).style.display = 'block';
                    
                    // Actualizar datos específicos de la sección
                    if (section === 'dashboard') {
                        updateDashboardMetrics();
                        initCharts();
                    } else if (section === 'employees') {
                        renderEmployees();
                    } else if (section === 'stock') {
                        renderStockTable();
                    } else if (section === 'suppliers') {
                        renderSuppliers();
                    } else if (section === 'sales') {
                        renderDetailedSales();
                    } else if (section === 'reports') {
                        initReportCharts();
                    }
                });
            });

            // Menú inferior del empleado
            bottomNavItems.forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    
                    // Remover clase active de todos los items
                    bottomNavItems.forEach(i => i.classList.remove('active'));
                    // Agregar clase active al item clickeado
                    this.classList.add('active');
                    
                    // Ocultar todas las secciones
                    document.querySelectorAll('.sale-section, .products-section, .debtors-section').forEach(s => {
                        s.style.display = 'none';
                    });
                    
                    // Mostrar la sección correspondiente
                    document.getElementById(`${section}-section`).style.display = 'block';
                    
                    // Cargar datos específicos
                    if (section === 'products') {
                        renderEmployeeProducts();
                    } else if (section === 'debtors') {
                        renderDebtors();
                    }
                });
            });

            // Métodos de pago
            paymentMethods.forEach(method => {
                method.addEventListener('click', function() {
                    // Remover clase active de todos los métodos
                    paymentMethods.forEach(m => m.classList.remove('active'));
                    // Agregar clase active al método clickeado
                    this.classList.add('active');
                    
                    // Actualizar método de pago actual
                    currentPaymentMethod = this.getAttribute('data-method');
                });
            });

            // Completar venta
            completeSaleBtn.addEventListener('click', function() {
                if (cart.length === 0) {
                    alert('No hay productos en el carrito');
                    return;
                }
                
                const total = calculateCartTotal();
                const paymentMethodText = getPaymentMethodText(currentPaymentMethod);
                
                // Crear objeto de venta
                const sale = {
                    date: new Date().toISOString(),
                    employee: document.querySelector('.employee-dashboard .user-name').textContent,
                    products: cart.map(item => ({
                        productId: item.id,
                        name: item.name,
                        quantity: item.quantity,
                        price: item.price
                    })),
                    total: total,
                    method: currentPaymentMethod,
                    completed: true
                };
                
                // Guardar venta
                AppData.addSale(sale);
                
                // Actualizar stock de productos
                cart.forEach(item => {
                    AppData.updateStock(item.id, item.quantity, 'remove', 'Venta');
                });
                
                // Mostrar confirmación
                alert(`Venta completada!\nTotal: $${total}\nMétodo de pago: ${paymentMethodText}\nGracias por su compra.`);
                
                // Agregar a historial de ventas del día
                addToDailySales(sale);
                
                // Limpiar carrito
                cart = [];
                renderCart();
                renderProducts(); // Actualizar stock en vista de productos
                renderDailySales(); // Actualizar lista de ventas del día
            });

            // Búsqueda de productos
            productSearch.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const products = AppData.getProducts();
                const filteredProducts = products.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) || 
                    product.code.includes(searchTerm)
                );
                renderProducts(filteredProducts);
            });

            // Escanear código de barras
            scanBarcodeBtn.addEventListener('click', function() {
                barcodeModal.style.display = 'flex';
                manualBarcodeInput.focus();
            });

            closeBarcodeModal.addEventListener('click', function() {
                barcodeModal.style.display = 'none';
            });

            // Simular escaneo de código de barras
            simulateScanBtn.addEventListener('click', function() {
                const barcode = manualBarcodeInput.value.trim();
                if (barcode) {
                    const products = AppData.getProducts();
                    const product = products.find(p => p.code === barcode);
                    
                    if (product) {
                        addToCart(product.id);
                        barcodeModal.style.display = 'none';
                        manualBarcodeInput.value = '';
                        alert(`Producto encontrado: ${product.name}`);
                    } else {
                        alert('Producto no encontrado. Verifica el código de barras.');
                    }
                } else {
                    // Simular escaneo aleatorio
                    const products = AppData.getProducts();
                    const randomProduct = products[Math.floor(Math.random() * products.length)];
                    addToCart(randomProduct.id);
                    barcodeModal.style.display = 'none';
                    alert(`Producto escaneado: ${randomProduct.name}`);
                }
            });

            // Modal para agregar producto
            addProductBtn.addEventListener('click', function() {
                document.getElementById('product-modal-title').textContent = 'Agregar Producto';
                productForm.reset();
                populateSupplierDropdown();
                productModal.style.display = 'flex';
            });

            closeProductModal.addEventListener('click', function() {
                productModal.style.display = 'none';
            });

            // Modal para agregar deudor
            addDebtorBtn.addEventListener('click', function() {
                debtorForm.reset();
                // Establecer fecha de vencimiento por defecto (7 días desde hoy)
                const dueDate = new Date();
                dueDate.setDate(dueDate.getDate() + 7);
                document.getElementById('debtor-duedate').value = dueDate.toISOString().split('T')[0];
                debtorModal.style.display = 'flex';
            });

            closeDebtorModal.addEventListener('click', function() {
                debtorModal.style.display = 'none';
            });

            // Modal para agregar empleado
            addEmployeeBtn.addEventListener('click', function() {
                document.getElementById('employee-modal-title').textContent = 'Agregar Empleado';
                employeeForm.reset();
                document.getElementById('employee-id').value = '';
                // Generar selector de días de trabajo
                generateWorkDaysSelector();
                employeeModal.style.display = 'flex';
            });

            closeEmployeeModal.addEventListener('click', function() {
                employeeModal.style.display = 'none';
            });

            // Modal para agregar proveedor
            addSupplierBtn.addEventListener('click', function() {
                document.getElementById('supplier-modal-title').textContent = 'Agregar Proveedor';
                supplierForm.reset();
                document.getElementById('supplier-id').value = '';
                supplierModal.style.display = 'flex';
            });

            closeSupplierModal.addEventListener('click', function() {
                supplierModal.style.display = 'none';
            });

            // Modal para agregar producto en stock
            addStockProductBtn.addEventListener('click', function() {
                document.getElementById('product-modal-title').textContent = 'Agregar Producto';
                productForm.reset();
                populateSupplierDropdown();
                productModal.style.display = 'flex';
            });

            // Cerrar modales al hacer clic fuera
            window.addEventListener('click', function(e) {
                if (e.target === productModal) productModal.style.display = 'none';
                if (e.target === debtorModal) debtorModal.style.display = 'none';
                if (e.target === employeeModal) employeeModal.style.display = 'none';
                if (e.target === supplierModal) supplierModal.style.display = 'none';
                if (e.target === barcodeModal) barcodeModal.style.display = 'none';
            });

            // Formulario de producto
            productForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('product-name').value;
                const code = document.getElementById('product-code').value;
                const price = parseFloat(document.getElementById('product-price').value);
                const cost = parseFloat(document.getElementById('product-cost').value);
                const stock = parseInt(document.getElementById('product-stock').value);
                const minStock = parseInt(document.getElementById('product-min-stock').value);
                const category = document.getElementById('product-category').value;
                const supplierId = document.getElementById('product-supplier').value ? parseInt(document.getElementById('product-supplier').value) : null;
                
                // Validar que el código no exista
                const products = AppData.getProducts();
                if (products.some(p => p.code === code && p.id !== parseInt(document.getElementById('employee-id').value || 0))) {
                    alert('Ya existe un producto con ese código de barras');
                    return;
                }
                
                // Agregar producto
                const newProduct = {
                    code: code,
                    name: name,
                    price: price,
                    cost: cost,
                    stock: stock,
                    minStock: minStock,
                    category: category,
                    supplierId: supplierId,
                    icon: getIconForCategory(category),
                    salesCount: 0
                };
                
                AppData.addProduct(newProduct);
                
                // Cerrar modal y limpiar formulario
                productModal.style.display = 'none';
                productForm.reset();
                
                // Actualizar vistas
                renderProducts();
                renderEmployeeProducts();
                renderStockTable();
                updateDashboardMetrics();
                
                alert('Producto agregado correctamente');
            });

            // Formulario de deudor
            debtorForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('debtor-name').value;
                const phone = document.getElementById('debtor-phone').value;
                const amount = parseFloat(document.getElementById('debtor-amount').value);
                const dueDate = document.getElementById('debtor-duedate').value;
                const notes = document.getElementById('debtor-notes').value;
                
                // Agregar deudor
                const newDebtor = {
                    name: name,
                    phone: phone,
                    amount: amount,
                    dueDate: dueDate,
                    notes: notes
                };
                
                AppData.addDebtor(newDebtor);
                
                // Cerrar modal y limpiar formulario
                debtorModal.style.display = 'none';
                debtorForm.reset();
                
                // Actualizar vista
                renderDebtors();
                updateDashboardMetrics();
                
                alert('Deudor agregado correctamente');
            });

            // Formulario de empleado
            employeeForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const id = document.getElementById('employee-id').value;
                const name = document.getElementById('employee-name').value;
                const lastName = document.getElementById('employee-lastname').value;
                const email = document.getElementById('employee-email').value;
                const phone = document.getElementById('employee-phone').value;
                const salary = parseFloat(document.getElementById('employee-salary').value);
                const position = document.getElementById('employee-position').value;
                
                // Obtener días de trabajo seleccionados
                const workDays = [];
                document.querySelectorAll('#work-days-selector .day-checkbox:checked').forEach(cb => {
                    workDays.push(parseInt(cb.value));
                });
                
                const employeeData = {
                    name: name,
                    lastName: lastName,
                    email: email,
                    phone: phone,
                    salary: salary,
                    position: position,
                    workDays: workDays
                };
                
                let savedEmployee;
                if (id) {
                    // Actualizar empleado existente
                    savedEmployee = AppData.updateEmployee(parseInt(id), employeeData);
                } else {
                    // Agregar nuevo empleado
                    savedEmployee = AppData.addEmployee(employeeData);
                }
                
                // Cerrar modal y limpiar formulario
                employeeModal.style.display = 'none';
                employeeForm.reset();
                
                // Actualizar vista
                renderEmployees();
                populateEmployeeFilter();
                
                alert(`Empleado ${id ? 'actualizado' : 'agregado'} correctamente`);
            });

            // Formulario de proveedor
            supplierForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const id = document.getElementById('supplier-id').value;
                const name = document.getElementById('supplier-name').value;
                const contact = document.getElementById('supplier-contact').value;
                const phone = document.getElementById('supplier-phone').value;
                const email = document.getElementById('supplier-email').value;
                const address = document.getElementById('supplier-address').value;
                const notes = document.getElementById('supplier-notes').value;
                
                // Obtener categorías seleccionadas
                const categorySelect = document.getElementById('supplier-category');
                const categories = Array.from(categorySelect.selectedOptions).map(option => option.value);
                
                const supplierData = {
                    name: name,
                    contact: contact,
                    phone: phone,
                    email: email,
                    address: address,
                    categories: categories,
                    notes: notes,
                    lastOrder: new Date().toISOString().split('T')[0]
                };
                
                let savedSupplier;
                if (id) {
                    // Actualizar proveedor existente
                    savedSupplier = AppData.updateSupplier(parseInt(id), supplierData);
                } else {
                    // Agregar nuevo proveedor
                    savedSupplier = AppData.addSupplier(supplierData);
                }
                
                // Cerrar modal y limpiar formulario
                supplierModal.style.display = 'none';
                supplierForm.reset();
                
                // Actualizar vista y dropdowns
                renderSuppliers();
                populateSupplierDropdown();
                
                alert(`Proveedor ${id ? 'actualizado' : 'agregado'} correctamente`);
            });

            // Filtros de ventas
            document.getElementById('date-from').addEventListener('change', renderDetailedSales);
            document.getElementById('date-to').addEventListener('change', renderDetailedSales);
            document.getElementById('employee-filter').addEventListener('change', renderDetailedSales);
            document.getElementById('payment-filter').addEventListener('change', renderDetailedSales);
        }

        // ===== FUNCIONES DE RENDERIZADO =====
        
        // Renderizar productos en la grilla de ventas
        function renderProducts(productsToRender = null) {
            const products = productsToRender || AppData.getProducts();
            productsGrid.innerHTML = '';
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.setAttribute('data-id', product.id);
                
                productCard.innerHTML = `
                    <div class="product-code">${product.code}</div>
                    <div class="product-img">
                        <i class="${product.icon}"></i>
                    </div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">$${product.price}</div>
                    <div class="product-stock">Stock: ${product.stock} ${product.stock <= product.minStock ? '⚠️' : ''}</div>
                `;
                
                productCard.addEventListener('click', function() {
                    addToCart(product.id);
                });
                
                productsGrid.appendChild(productCard);
            });
        }
        
        // Renderizar productos en la sección de gestión de productos del empleado
        function renderEmployeeProducts() {
            const products = AppData.getProducts();
            employeeProductsGrid.innerHTML = '';
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.setAttribute('data-id', product.id);
                
                productCard.innerHTML = `
                    <div class="product-code">${product.code}</div>
                    <div class="product-img">
                        <i class="${product.icon}"></i>
                    </div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">$${product.price}</div>
                    <div class="product-stock">Stock: ${product.stock}</div>
                    <button class="edit-product-btn" data-id="${product.id}" style="margin-top: 10px; padding: 8px 15px; background-color: var(--light-blue); color: var(--primary-blue); border: none; border-radius: var(--radius-small); cursor: pointer;">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                `;
                
                productCard.querySelector('.edit-product-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    const productId = parseInt(this.getAttribute('data-id'));
                    editProduct(productId);
                });
                
                employeeProductsGrid.appendChild(productCard);
            });
        }
        
        // Renderizar deudores
        function renderDebtors() {
            const debtors = AppData.getDebtors();
            debtorsGrid.innerHTML = '';
            
            if (debtors.length === 0) {
                debtorsGrid.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray-dark); grid-column: 1 / -1;">
                        <i class="fas fa-user-clock" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>No hay clientes con deuda registrados</p>
                    </div>
                `;
                return;
            }
            
            debtors.forEach(debtor => {
                const debtorCard = document.createElement('div');
                debtorCard.className = 'debtor-card';
                
                // Determinar estado
                let statusBadge = '';
                let statusClass = '';
                if (debtor.status === 'paid') {
                    statusBadge = '<span style="background-color: rgba(52, 168, 83, 0.1); color: var(--success); padding: 3px 8px; border-radius: 12px; font-size: 12px;">Pagado</span>';
                } else if (debtor.status === 'partial') {
                    statusBadge = '<span style="background-color: rgba(249, 168, 37, 0.1); color: var(--warning); padding: 3px 8px; border-radius: 12px; font-size: 12px;">Parcial</span>';
                } else {
                    const dueDate = new Date(debtor.dueDate);
                    const today = new Date();
                    if (dueDate < today) {
                        statusBadge = '<span style="background-color: rgba(234, 67, 53, 0.1); color: var(--danger); padding: 3px 8px; border-radius: 12px; font-size: 12px;">Vencido</span>';
                    } else {
                        statusBadge = '<span style="background-color: rgba(66, 133, 244, 0.1); color: var(--accent-blue); padding: 3px 8px; border-radius: 12px; font-size: 12px;">Pendiente</span>';
                    }
                }
                
                debtorCard.innerHTML = `
                    <div class="debtor-header">
                        <div>
                            <div class="debtor-name">${debtor.name}</div>
                            <div class="debtor-phone">${debtor.phone}</div>
                        </div>
                        ${statusBadge}
                    </div>
                    <div class="debtor-details">
                        <div class="debtor-amount">$${debtor.amount}</div>
                        <div class="debtor-date">Vence: ${new Date(debtor.dueDate).toLocaleDateString('es-AR')}</div>
                    </div>
                    ${debtor.notes ? `<div class="debtor-notes">${debtor.notes}</div>` : ''}
                    <div class="debtor-actions">
                        <button class="action-btn edit-btn" data-id="${debtor.id}">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="action-btn pay-btn" data-id="${debtor.id}">
                            <i class="fas fa-money-check"></i> Pagar
                        </button>
                        <button class="action-btn delete-btn" data-id="${debtor.id}">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                `;
                
                // Agregar eventos a los botones
                debtorCard.querySelector('.edit-btn').addEventListener('click', function() {
                    const debtorId = parseInt(this.getAttribute('data-id'));
                    editDebtor(debtorId);
                });
                
                debtorCard.querySelector('.pay-btn').addEventListener('click', function() {
                    const debtorId = parseInt(this.getAttribute('data-id'));
                    registerPayment(debtorId);
                });
                
                debtorCard.querySelector('.delete-btn').addEventListener('click', function() {
                    const debtorId = parseInt(this.getAttribute('data-id'));
                    if (confirm('¿Estás seguro de eliminar este deudor?')) {
                        AppData.deleteDebtor(debtorId);
                        renderDebtors();
                        updateDashboardMetrics();
                    }
                });
                
                debtorsGrid.appendChild(debtorCard);
            });
        }
        
        // Renderizar empleados
        function renderEmployees() {
            const employees = AppData.getEmployees();
            employeesGrid.innerHTML = '';
            
            employees.forEach(employee => {
                const employeeCard = document.createElement('div');
                employeeCard.className = 'employee-card';
                
                // Calcular días trabajados este mes (estimado)
                const workDaysCount = employee.workDays ? employee.workDays.length : 5;
                const daysWorked = workDaysCount * 4; // Aproximación de 4 semanas
                
                // Calcular salario por día
                const dailySalary = employee.salary / 30;
                
                // Generar calendario de días
                const daysHtml = generateDaysCalendar(employee.workDays || [1, 2, 3, 4, 5]);
                
                employeeCard.innerHTML = `
                    <div class="employee-header-card">
                        <div class="employee-avatar">${employee.name.charAt(0)}${employee.lastName.charAt(0)}</div>
                        <div class="employee-info">
                            <div class="employee-name">${employee.name} ${employee.lastName}</div>
                            <div class="employee-role">${getPositionName(employee.position)}</div>
                            <div style="font-size: 14px; color: var(--gray-dark);">${employee.email} · ${employee.phone}</div>
                        </div>
                    </div>
                    <div class="employee-stats">
                        <div class="stat-item">
                            <div class="stat-label">Sueldo Mensual</div>
                            <div class="stat-value">$${employee.salary.toLocaleString()}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Ventas Totales</div>
                            <div class="stat-value">${employee.salesCount || 0}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Días Trabajados</div>
                            <div class="stat-value">${daysWorked}/mes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Salario por Día</div>
                            <div class="stat-value">$${dailySalary.toFixed(0)}</div>
                        </div>
                    </div>
                    <div class="employee-schedule">
                        <div class="schedule-title">Días de Trabajo</div>
                        <div class="schedule-days">
                            ${daysHtml}
                        </div>
                    </div>
                    <div class="debtor-actions">
                        <button class="action-btn edit-btn" data-id="${employee.id}">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="action-btn pay-btn" data-id="${employee.id}">
                            <i class="fas fa-money-check"></i> Pagar
                        </button>
                    </div>
                `;
                
                // Agregar eventos a los botones
                employeeCard.querySelector('.edit-btn').addEventListener('click', function() {
                    const employeeId = parseInt(this.getAttribute('data-id'));
                    editEmployee(employeeId);
                });
                
                employeeCard.querySelector('.pay-btn').addEventListener('click', function() {
                    const employeeId = parseInt(this.getAttribute('data-id'));
                    const employee = AppData.getEmployees().find(e => e.id === employeeId);
                    if (employee) {
                        if (confirm(`¿Registrar pago de $${employee.salary} a ${employee.name} ${employee.lastName}?`)) {
                            alert(`Pago registrado correctamente.`);
                        }
                    }
                });
                
                employeesGrid.appendChild(employeeCard);
            });
        }
        
        // Renderizar tabla de stock
        function renderStockTable() {
            const products = AppData.getProducts();
            const suppliers = AppData.getSuppliers();
            stockTableBody.innerHTML = '';
            
            products.forEach(product => {
                const supplier = product.supplierId ? suppliers.find(s => s.id === product.supplierId) : null;
                const stockStatus = product.stock <= product.minStock ? 'badge-danger' : (product.stock <= product.minStock * 2 ? 'badge-warning' : 'badge-success');
                const statusText = product.stock <= product.minStock ? 'Bajo' : (product.stock <= product.minStock * 2 ? 'Medio' : 'Normal');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.code}</td>
                    <td>${product.name}</td>
                    <td>${getCategoryName(product.category)}</td>
                    <td>${product.stock}</td>
                    <td>${product.minStock}</td>
                    <td>${new Date().toLocaleDateString('es-AR')}</td>
                    <td>${supplier ? supplier.name : 'Sin proveedor'}</td>
                    <td>
                        <div class="stock-actions">
                            <button class="stock-btn add-stock-btn" data-id="${product.id}">
                                <i class="fas fa-plus"></i> Agregar
                            </button>
                            <button class="stock-btn remove-stock-btn" data-id="${product.id}">
                                <i class="fas fa-minus"></i> Quitar
                            </button>
                            <button class="stock-btn edit-btn" data-id="${product.id}">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                        </div>
                    </td>
                `;
                
                // Agregar eventos a los botones
                row.querySelector('.add-stock-btn').addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const quantity = prompt('Cantidad a agregar:', '10');
                    if (quantity && !isNaN(quantity) && parseInt(quantity) > 0) {
                        AppData.updateStock(productId, parseInt(quantity), 'add', 'Reabastecimiento manual');
                        renderStockTable();
                        renderProducts();
                        updateDashboardMetrics();
                    }
                });
                
                row.querySelector('.remove-stock-btn').addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const product = AppData.getProductById(productId);
                    const quantity = prompt(`Cantidad a quitar (stock actual: ${product.stock}):`, '1');
                    if (quantity && !isNaN(quantity) && parseInt(quantity) > 0) {
                        AppData.updateStock(productId, parseInt(quantity), 'remove', 'Ajuste manual');
                        renderStockTable();
                        renderProducts();
                        updateDashboardMetrics();
                    }
                });
                
                row.querySelector('.edit-btn').addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    editProduct(productId);
                });
                
                stockTableBody.appendChild(row);
            });
        }
        
        // Renderizar proveedores
        function renderSuppliers() {
            const suppliers = AppData.getSuppliers();
            const products = AppData.getProducts();
            suppliersGrid.innerHTML = '';
            
            suppliers.forEach(supplier => {
                // Obtener productos de este proveedor
                const supplierProducts = products.filter(p => p.supplierId === supplier.id);
                const productsHtml = supplierProducts.map(p => 
                    `<span class="product-tag">${p.name}</span>`
                ).join('');
                
                const supplierCard = document.createElement('div');
                supplierCard.className = 'supplier-card';
                
                supplierCard.innerHTML = `
                    <div class="supplier-header">
                        <div class="supplier-name">${supplier.name}</div>
                        <div class="supplier-status status-active">Activo</div>
                    </div>
                    <div class="supplier-contact">
                        <div class="contact-item">
                            <i class="fas fa-user"></i>
                            <span>${supplier.contact}</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <span>${supplier.phone}</span>
                        </div>
                        ${supplier.email ? `
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <span>${supplier.email}</span>
                        </div>` : ''}
                        ${supplier.address ? `
                        <div class="contact-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${supplier.address}</span>
                        </div>` : ''}
                    </div>
                    <div class="supplier-products">
                        <div class="products-title">Productos suministrados</div>
                        <div class="products-list">
                            ${productsHtml || '<span style="color: var(--gray-dark); font-size: 14px;">Sin productos registrados</span>'}
                        </div>
                    </div>
                    ${supplier.notes ? `<div class="debtor-notes">${supplier.notes}</div>` : ''}
                    <div class="debtor-actions">
                        <button class="action-btn edit-btn" data-id="${supplier.id}">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="action-btn pay-btn" data-id="${supplier.id}">
                            <i class="fas fa-shopping-cart"></i> Pedido
                        </button>
                    </div>
                `;
                
                // Agregar eventos a los botones
                supplierCard.querySelector('.edit-btn').addEventListener('click', function() {
                    const supplierId = parseInt(this.getAttribute('data-id'));
                    editSupplier(supplierId);
                });
                
                supplierCard.querySelector('.pay-btn').addEventListener('click', function() {
                    const supplierId = parseInt(this.getAttribute('data-id'));
                    const supplier = AppData.getSupplierById(supplierId);
                    if (supplier) {
                        if (confirm(`¿Generar orden de compra para ${supplier.name}?`)) {
                            alert(`Orden de compra generada. Se envió a ${supplier.contact}.`);
                        }
                    }
                });
                
                suppliersGrid.appendChild(supplierCard);
            });
        }
        
        // Renderizar ventas del día
        function renderDailySales() {
            const sales = AppData.getSales();
            const today = new Date().toISOString().split('T')[0];
            const todaySales = sales.filter(s => s.date.split('T')[0] === today);
            dailySalesList.innerHTML = '';
            
            if (todaySales.length === 0) {
                dailySalesList.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--gray-dark);">
                        <i class="fas fa-receipt" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>No hay ventas registradas hoy</p>
                    </div>
                `;
                return;
            }
            
            // Ordenar por fecha (más reciente primero)
            todaySales.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            todaySales.forEach(sale => {
                const saleTime = new Date(sale.date).toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
                const methodText = getPaymentMethodText(sale.method);
                
                const saleRecord = document.createElement('div');
                saleRecord.className = 'sale-record';
                saleRecord.innerHTML = `
                    <div class="sale-info">
                        <div class="sale-time">${saleTime} - ${sale.employee}</div>
                        <div class="sale-amount">$${sale.total}</div>
                        <div class="sale-method">${methodText} · ${sale.products.length} productos</div>
                    </div>
                    <div>
                        <i class="fas fa-check-circle" style="color: var(--success); font-size: 24px;"></i>
                    </div>
                `;
                
                dailySalesList.appendChild(saleRecord);
            });
        }
        
        // Renderizar ventas recientes en dashboard
        function renderRecentSales() {
            const sales = AppData.getSales();
            const tbody = recentSalesTable.querySelector('tbody');
            tbody.innerHTML = '';
            
            // Ordenar por fecha (más reciente primero) y tomar las últimas 5
            const recentSales = [...sales]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            recentSales.forEach(sale => {
                const saleTime = new Date(sale.date).toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
                const methodBadge = sale.method === 'cash' ? 'badge-success' : (sale.method === 'card' ? 'badge-warning' : 'badge-success');
                const methodText = sale.method === 'cash' ? 'Efectivo' : (sale.method === 'card' ? 'Tarjeta' : 'QR');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${saleTime}</td>
                    <td>${sale.employee}</td>
                    <td>$${sale.total}</td>
                    <td><span class="badge ${methodBadge}">${methodText}</span></td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Renderizar productos bajos en stock
        function renderLowStockProducts() {
            const lowStockProducts = AppData.getLowStockProducts();
            const tbody = lowStockTable.querySelector('tbody');
            tbody.innerHTML = '';
            
            lowStockProducts.forEach(product => {
                const statusClass = product.stock <= 0 ? 'badge-danger' : (product.stock <= product.minStock / 2 ? 'badge-danger' : 'badge-warning');
                const statusText = product.stock <= 0 ? 'Agotado' : (product.stock <= product.minStock / 2 ? 'Muy Bajo' : 'Bajo');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.stock}</td>
                    <td>${product.minStock}</td>
                    <td><span class="badge ${statusClass}">${statusText}</span></td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Renderizar ventas detalladas
        function renderDetailedSales() {
            const sales = AppData.getSales();
            const tbody = detailedSalesTable.querySelector('tbody');
            tbody.innerHTML = '';
            
            // Aplicar filtros
            let filteredSales = [...sales];
            
            const dateFrom = document.getElementById('date-from').value;
            const dateTo = document.getElementById('date-to').value;
            const employeeFilter = document.getElementById('employee-filter').value;
            const paymentFilter = document.getElementById('payment-filter').value;
            
            if (dateFrom) {
                filteredSales = filteredSales.filter(s => s.date.split('T')[0] >= dateFrom);
            }
            
            if (dateTo) {
                filteredSales = filteredSales.filter(s => s.date.split('T')[0] <= dateTo);
            }
            
            if (employeeFilter !== 'all') {
                filteredSales = filteredSales.filter(s => s.employee === employeeFilter);
            }
            
            if (paymentFilter !== 'all') {
                filteredSales = filteredSales.filter(s => s.method === paymentFilter);
            }
            
            // Ordenar por fecha (más reciente primero)
            filteredSales.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Actualizar resumen
            updateSalesSummary(filteredSales);
            
            // Renderizar tabla
            filteredSales.forEach(sale => {
                const saleDate = new Date(sale.date);
                const dateStr = saleDate.toLocaleDateString('es-AR');
                const timeStr = saleDate.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
                const methodText = getPaymentMethodText(sale.method);
                const productsText = sale.products.map(p => `${p.name} (x${p.quantity})`).join(', ');
                const totalProducts = sale.products.reduce((sum, p) => sum + p.quantity, 0);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dateStr} ${timeStr}</td>
                    <td>${sale.employee}</td>
                    <td>${productsText}</td>
                    <td>${totalProducts}</td>
                    <td>$${sale.total}</td>
                    <td>${methodText}</td>
                    <td>
                        <button class="stock-btn edit-btn" data-id="${sale.id}" style="padding: 5px 10px;">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                    </td>
                `;
                
                row.querySelector('button').addEventListener('click', function() {
                    const saleId = parseInt(this.getAttribute('data-id'));
                    viewSaleDetails(saleId);
                });
                
                tbody.appendChild(row);
            });
        }
        
        // ===== FUNCIONES DE CARRITO Y VENTAS =====
        
        function addToCart(productId) {
            const product = AppData.getProductById(productId);
            
            if (!product) return;
            
            // Verificar si hay stock disponible
            if (product.stock <= 0) {
                alert('No hay stock disponible de este producto');
                return;
            }
            
            // Verificar si el producto ya está en el carrito
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                // Verificar si hay suficiente stock para agregar más
                if (existingItem.quantity >= product.stock) {
                    alert('No hay suficiente stock disponible');
                    return;
                }
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1
                });
            }
            
            // Actualizar la vista del carrito
            renderCart();
        }
        
        function renderCart() {
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--gray-dark);">
                        <i class="fas fa-shopping-cart" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>No hay productos en el carrito</p>
                    </div>
                `;
                cartTotal.textContent = '$0';
                return;
            }
            
            cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                
                cartItem.innerHTML = `
                    <div class="cart-item-name">${item.name}</div>
                    <div class="cart-item-controls">
                        <button class="quantity-btn minus" data-id="${item.id}">-</button>
                        <span class="cart-item-quantity">${item.quantity}</span>
                        <button class="quantity-btn plus" data-id="${item.id}">+</button>
                    </div>
                    <div class="cart-item-price">$${item.price * item.quantity}</div>
                `;
                
                cartItems.appendChild(cartItem);
            });
            
            // Actualizar total
            cartTotal.textContent = `$${calculateCartTotal()}`;
            
            // Agregar eventos a los botones de cantidad
            document.querySelectorAll('.quantity-btn.minus').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    decreaseQuantity(productId);
                });
            });
            
            document.querySelectorAll('.quantity-btn.plus').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    increaseQuantity(productId);
                });
            });
        }
        
        function increaseQuantity(productId) {
            const cartItem = cart.find(item => item.id === productId);
            const product = AppData.getProductById(productId);
            
            if (!cartItem || !product) return;
            
            // Verificar si hay stock disponible
            if (product.stock <= cartItem.quantity) {
                alert('No hay stock disponible de este producto');
                return;
            }
            
            cartItem.quantity += 1;
            renderCart();
        }
        
        function decreaseQuantity(productId) {
            const cartItemIndex = cart.findIndex(item => item.id === productId);
            
            if (cartItemIndex === -1) return;
            
            const cartItem = cart[cartItemIndex];
            
            if (cartItem.quantity > 1) {
                cartItem.quantity -= 1;
            } else {
                // Eliminar producto del carrito si la cantidad es 1
                cart.splice(cartItemIndex, 1);
            }
            
            renderCart();
        }
        
        function calculateCartTotal() {
            return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        }
        
        function getPaymentMethodText(method) {
            switch(method) {
                case 'cash': return 'Efectivo';
                case 'card': return 'Tarjeta de Crédito/Débito';
                case 'qr': return 'QR';
                default: return 'Efectivo';
            }
        }
        
        function addToDailySales(sale) {
            dailySales.push(sale);
        }
        
        // ===== FUNCIONES DE EDICIÓN =====
        
        function editProduct(productId) {
            const product = AppData.getProductById(productId);
            if (!product) return;
            
            document.getElementById('product-modal-title').textContent = 'Editar Producto';
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-code').value = product.code;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-cost').value = product.cost;
            document.getElementById('product-stock').value = product.stock;
            document.getElementById('product-min-stock').value = product.minStock;
            document.getElementById('product-category').value = product.category;
            
            // Necesitaríamos un campo oculto para el ID del producto
            // Por simplicidad, en este demo vamos a agregar un campo oculto temporal
            if (!document.getElementById('product-id')) {
                const idInput = document.createElement('input');
                idInput.type = 'hidden';
                idInput.id = 'product-id';
                productForm.appendChild(idInput);
            }
            document.getElementById('product-id').value = productId;
            
            populateSupplierDropdown();
            if (product.supplierId) {
                document.getElementById('product-supplier').value = product.supplierId;
            }
            
            productModal.style.display = 'flex';
            
            // Modificar el submit del formulario para actualizar
            const originalSubmit = productForm.onsubmit;
            productForm.onsubmit = function(e) {
                e.preventDefault();
                
                const id = parseInt(document.getElementById('product-id').value);
                const name = document.getElementById('product-name').value;
                const code = document.getElementById('product-code').value;
                const price = parseFloat(document.getElementById('product-price').value);
                const cost = parseFloat(document.getElementById('product-cost').value);
                const stock = parseInt(document.getElementById('product-stock').value);
                const minStock = parseInt(document.getElementById('product-min-stock').value);
                const category = document.getElementById('product-category').value;
                const supplierId = document.getElementById('product-supplier').value ? parseInt(document.getElementById('product-supplier').value) : null;
                
                // Actualizar producto
                const updated = AppData.updateProduct(id, {
                    name, code, price, cost, stock, minStock, category, supplierId
                });
                
                if (updated) {
                    alert('Producto actualizado correctamente');
                    productModal.style.display = 'none';
                    productForm.reset();
                    
                    // Restaurar el submit original
                    productForm.onsubmit = originalSubmit;
                    
                    // Actualizar vistas
                    renderProducts();
                    renderEmployeeProducts();
                    renderStockTable();
                    updateDashboardMetrics();
                }
            };
        }
        
        function editDebtor(debtorId) {
            const debtors = AppData.getDebtors();
            const debtor = debtors.find(d => d.id === debtorId);
            if (!debtor) return;
            
            document.getElementById('debtor-name').value = debtor.name;
            document.getElementById('debtor-phone').value = debtor.phone;
            document.getElementById('debtor-amount').value = debtor.amount;
            document.getElementById('debtor-duedate').value = debtor.dueDate;
            document.getElementById('debtor-notes').value = debtor.notes || '';
            
            // Campo oculto para ID
            if (!document.getElementById('debtor-id')) {
                const idInput = document.createElement('input');
                idInput.type = 'hidden';
                idInput.id = 'debtor-id';
                debtorForm.appendChild(idInput);
            }
            document.getElementById('debtor-id').value = debtorId;
            
            debtorModal.style.display = 'flex';
            
            // Modificar el submit del formulario para actualizar
            const originalSubmit = debtorForm.onsubmit;
            debtorForm.onsubmit = function(e) {
                e.preventDefault();
                
                const id = parseInt(document.getElementById('debtor-id').value);
                const name = document.getElementById('debtor-name').value;
                const phone = document.getElementById('debtor-phone').value;
                const amount = parseFloat(document.getElementById('debtor-amount').value);
                const dueDate = document.getElementById('debtor-duedate').value;
                const notes = document.getElementById('debtor-notes').value;
                
                // Actualizar deudor
                const updated = AppData.updateDebtor(id, {
                    name, phone, amount, dueDate, notes
                });
                
                if (updated) {
                    alert('Deudor actualizado correctamente');
                    debtorModal.style.display = 'none';
                    debtorForm.reset();
                    
                    // Restaurar el submit original
                    debtorForm.onsubmit = originalSubmit;
                    
                    // Actualizar vista
                    renderDebtors();
                    updateDashboardMetrics();
                }
            };
        }
        
        function editEmployee(employeeId) {
            const employees = AppData.getEmployees();
            const employee = employees.find(e => e.id === employeeId);
            if (!employee) return;
            
            document.getElementById('employee-modal-title').textContent = 'Editar Empleado';
            document.getElementById('employee-id').value = employee.id;
            document.getElementById('employee-name').value = employee.name;
            document.getElementById('employee-lastname').value = employee.lastName;
            document.getElementById('employee-email').value = employee.email || '';
            document.getElementById('employee-phone').value = employee.phone;
            document.getElementById('employee-salary').value = employee.salary;
            document.getElementById('employee-position').value = employee.position;
            
            // Generar selector de días de trabajo
            generateWorkDaysSelector(employee.workDays || [1, 2, 3, 4, 5]);
            
            employeeModal.style.display = 'flex';
        }
        
        function editSupplier(supplierId) {
            const suppliers = AppData.getSuppliers();
            const supplier = suppliers.find(s => s.id === supplierId);
            if (!supplier) return;
            
            document.getElementById('supplier-modal-title').textContent = 'Editar Proveedor';
            document.getElementById('supplier-id').value = supplier.id;
            document.getElementById('supplier-name').value = supplier.name;
            document.getElementById('supplier-contact').value = supplier.contact;
            document.getElementById('supplier-phone').value = supplier.phone;
            document.getElementById('supplier-email').value = supplier.email || '';
            document.getElementById('supplier-address').value = supplier.address || '';
            document.getElementById('supplier-notes').value = supplier.notes || '';
            
            // Seleccionar categorías
            const categorySelect = document.getElementById('supplier-category');
            Array.from(categorySelect.options).forEach(option => {
                option.selected = supplier.categories && supplier.categories.includes(option.value);
            });
            
            supplierModal.style.display = 'flex';
        }
        
        function registerPayment(debtorId) {
            const debtors = AppData.getDebtors();
            const debtor = debtors.find(d => d.id === debtorId);
            if (!debtor) return;
            
            const amount = prompt(`Monto a registrar como pago (Deuda total: $${debtor.amount}):`, debtor.amount.toString());
            if (amount && !isNaN(amount) && parseFloat(amount) > 0) {
                const paymentAmount = parseFloat(amount);
                
                if (paymentAmount >= debtor.amount) {
                    // Pago completo
                    AppData.updateDebtor(debtorId, { 
                        amount: 0,
                        status: 'paid'
                    });
                    alert('Pago completo registrado. Deuda saldada.');
                } else {
                    // Pago parcial
                    AppData.updateDebtor(debtorId, { 
                        amount: debtor.amount - paymentAmount,
                        status: 'partial'
                    });
                    alert(`Pago parcial de $${paymentAmount} registrado. Saldo restante: $${debtor.amount - paymentAmount}`);
                }
                
                renderDebtors();
                updateDashboardMetrics();
            }
        }
        
        function viewSaleDetails(saleId) {
            const sales = AppData.getSales();
            const sale = sales.find(s => s.id === saleId);
            if (!sale) return;
            
            const saleDate = new Date(sale.date);
            const dateStr = saleDate.toLocaleDateString('es-AR');
            const timeStr = saleDate.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
            const methodText = getPaymentMethodText(sale.method);
            
            let details = `Venta #${sale.id}\n`;
            details += `Fecha: ${dateStr} ${timeStr}\n`;
            details += `Empleado: ${sale.employee}\n`;
            details += `Método de pago: ${methodText}\n\n`;
            details += `Productos:\n`;
            
            sale.products.forEach(p => {
                details += `- ${p.name} x${p.quantity}: $${p.price * p.quantity}\n`;
            });
            
            details += `\nTotal: $${sale.total}`;
            
            alert(details);
        }
        
        // ===== FUNCIONES AUXILIARES =====
        
        function populateSupplierDropdown() {
            const suppliers = AppData.getSuppliers();
            const supplierSelect = document.getElementById('product-supplier');
            
            // Guardar el valor seleccionado actual
            const currentValue = supplierSelect.value;
            
            // Limpiar opciones excepto la primera
            while (supplierSelect.options.length > 1) {
                supplierSelect.remove(1);
            }
            
            // Agregar opciones de proveedores
            suppliers.forEach(supplier => {
                const option = document.createElement('option');
                option.value = supplier.id;
                option.textContent = supplier.name;
                supplierSelect.appendChild(option);
            });
            
            // Restaurar el valor seleccionado si existe
            if (currentValue && suppliers.some(s => s.id === parseInt(currentValue))) {
                supplierSelect.value = currentValue;
            }
        }
        
        function populateEmployeeFilter() {
            const employees = AppData.getEmployees();
            const employeeFilter = document.getElementById('employee-filter');
            
            // Limpiar opciones excepto la primera
            while (employeeFilter.options.length > 1) {
                employeeFilter.remove(1);
            }
            
            // Agregar opciones de empleados
            employees.forEach(employee => {
                const option = document.createElement('option');
                option.value = `${employee.name} ${employee.lastName}`;
                option.textContent = `${employee.name} ${employee.lastName}`;
                employeeFilter.appendChild(option);
            });
        }
        
        function generateWorkDaysSelector(selectedDays = [1, 2, 3, 4, 5]) {
            const daysContainer = document.getElementById('work-days-selector');
            daysContainer.innerHTML = '';
            
            const days = ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'];
            
            days.forEach((day, index) => {
                const dayNum = index + 1; // 1 = Lunes, 7 = Domingo
                const isChecked = selectedDays.includes(dayNum);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'day';
                dayElement.innerHTML = `
                    <div class="day-name">${day}</div>
                    <input type="checkbox" class="day-checkbox" value="${dayNum}" ${isChecked ? 'checked' : ''} style="display: none;">
                    <div class="day-status ${isChecked ? 'work' : 'free'}"></div>
                `;
                
                // Al hacer clic, alternar estado
                dayElement.addEventListener('click', function() {
                    const checkbox = this.querySelector('.day-checkbox');
                    const status = this.querySelector('.day-status');
                    
                    checkbox.checked = !checkbox.checked;
                    status.className = checkbox.checked ? 'day-status work' : 'day-status free';
                });
                
                daysContainer.appendChild(dayElement);
            });
        }
        
        function generateDaysCalendar(workDays) {
            const days = ['L', 'M', 'M', 'J', 'V', 'S', 'D'];
            let html = '';
            
            days.forEach((day, index) => {
                const dayNum = index + 1;
                const isWorkDay = workDays.includes(dayNum);
                html += `
                    <div class="day">
                        <div class="day-name">${day}</div>
                        <div class="day-status ${isWorkDay ? 'work' : 'free'}"></div>
                    </div>
                `;
            });
            
            return html;
        }
        
        function getIconForCategory(category) {
            const icons = {
                'bebidas': 'fas fa-wine-bottle',
                'snacks': 'fas fa-cookie',
                'lacteos': 'fas fa-wine-bottle',
                'panaderia': 'fas fa-bread-slice',
                'limpieza': 'fas fa-pump-soap',
                'otros': 'fas fa-box'
            };
            return icons[category] || 'fas fa-box';
        }
        
        function getCategoryName(category) {
            const names = {
                'bebidas': 'Bebidas',
                'snacks': 'Snacks',
                'lacteos': 'Lácteos',
                'panaderia': 'Panadería',
                'limpieza': 'Limpieza',
                'otros': 'Otros'
            };
            return names[category] || category;
        }
        
        function getPositionName(position) {
            const names = {
                'cajero': 'Cajero',
                'repositor': 'Repositor',
                'supervisor': 'Supervisor'
            };
            return names[position] || position;
        }
        
        // ===== FUNCIONES DEL DASHBOARD =====
        
        function updateDashboardMetrics() {
            const todaySales = AppData.getTodaySales();
            const lowStockCount = AppData.getLowStockProducts().length;
            const totalDebts = AppData.getTotalDebts();
            const debtorsCount = AppData.getDebtors().length;
            
            document.getElementById('sales-today').textContent = `$${todaySales.total.toLocaleString()}`;
            document.getElementById('transactions-today').textContent = todaySales.count;
            document.getElementById('low-stock-count').textContent = lowStockCount;
            document.getElementById('total-debts').textContent = `$${totalDebts.toLocaleString()}`;
            document.getElementById('debtors-count').textContent = debtorsCount;
            
            // Calcular cambios porcentuales (simulados)
            const salesChange = 12; // Simulado
            const transactionsChange = 8; // Simulado
            
            document.getElementById('sales-change').textContent = `${salesChange}%`;
            document.getElementById('transactions-change').textContent = `${transactionsChange}%`;
        }
        
        function updateSalesSummary(sales) {
            const totalSales = sales.reduce((sum, s) => sum + s.total, 0);
            const totalTransactions = sales.length;
            const avgSale = totalTransactions > 0 ? totalSales / totalTransactions : 0;
            
            // Encontrar el día con más ventas (simplificado)
            const bestDay = 'Viernes'; // Simulado
            
            document.getElementById('total-sales').textContent = `$${totalSales.toLocaleString()}`;
            document.getElementById('total-transactions').textContent = totalTransactions;
            document.getElementById('avg-sale').textContent = `$${avgSale.toFixed(0)}`;
            document.getElementById('best-day').textContent = bestDay;
        }
        
        // ===== GRÁFICOS =====
        
        let weeklySalesChart, topProductsChart, profitabilityChart, categorySalesChart, monthlyTrendChart, employeeEfficiencyChart;
        
        function initCharts() {
            // Gráfico de ventas semanales
            const weeklyData = AppData.getWeeklySalesData();
            const weeklyCtx = document.getElementById('weeklySalesChart').getContext('2d');
            
            if (weeklySalesChart) weeklySalesChart.destroy();
            
            weeklySalesChart = new Chart(weeklyCtx, {
                type: 'bar',
                data: {
                    labels: weeklyData.labels,
                    datasets: [{
                        label: 'Ventas ($)',
                        data: weeklyData.data,
                        backgroundColor: 'rgba(66, 133, 244, 0.7)',
                        borderColor: 'rgba(66, 133, 244, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Gráfico de productos más vendidos
            const topProducts = AppData.getTopProducts();
            const topProductsCtx = document.getElementById('topProductsChart').getContext('2d');
            
            if (topProductsChart) topProductsChart.destroy();
            
            topProductsChart = new Chart(topProductsCtx, {
                type: 'doughnut',
                data: {
                    labels: topProducts.map(p => p.name),
                    datasets: [{
                        label: 'Ventas',
                        data: topProducts.map(p => p.salesCount || 0),
                        backgroundColor: [
                            'rgba(66, 133, 244, 0.7)',
                            'rgba(52, 168, 83, 0.7)',
                            'rgba(251, 188, 5, 0.7)',
                            'rgba(234, 67, 53, 0.7)',
                            'rgba(171, 71, 188, 0.7)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
            
            // Inicializar gráficos de reportes
            initReportCharts();
        }
        
        function initReportCharts() {
            // Gráfico de rentabilidad
            const profitabilityData = AppData.getProfitabilityData();
            const profitabilityCtx = document.getElementById('profitabilityChart').getContext('2d');
            
            if (profitabilityChart) profitabilityChart.destroy();
            
            profitabilityChart = new Chart(profitabilityCtx, {
                type: 'pie',
                data: {
                    labels: ['Costo', 'Ganancia'],
                    datasets: [{
                        data: [profitabilityData.cost, profitabilityData.grossProfit],
                        backgroundColor: [
                            'rgba(234, 67, 53, 0.7)',
                            'rgba(52, 168, 83, 0.7)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Actualizar métricas de rentabilidad
            document.getElementById('profit-margin').textContent = `${profitabilityData.profitMargin.toFixed(1)}%`;
            document.getElementById('roi').textContent = `${profitabilityData.roi.toFixed(1)}%`;
            document.getElementById('break-even').textContent = `${profitabilityData.breakEvenDays} días`;
            
            // Gráfico de ventas por categoría
            const categoryData = AppData.getSalesByCategory();
            const categoryCtx = document.getElementById('categorySalesChart').getContext('2d');
            
            if (categorySalesChart) categorySalesChart.destroy();
            
            categorySalesChart = new Chart(categoryCtx, {
                type: 'polarArea',
                data: {
                    labels: categoryData.labels,
                    datasets: [{
                        label: 'Ventas ($)',
                        data: categoryData.data,
                        backgroundColor: [
                            'rgba(66, 133, 244, 0.7)',
                            'rgba(52, 168, 83, 0.7)',
                            'rgba(251, 188, 5, 0.7)',
                            'rgba(234, 67, 53, 0.7)',
                            'rgba(171, 71, 188, 0.7)',
                            'rgba(0, 172, 193, 0.7)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            ticks: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Gráfico de tendencia mensual
            const trendData = AppData.getMonthlyTrend();
            const trendCtx = document.getElementById('monthlyTrendChart').getContext('2d');
            
            if (monthlyTrendChart) monthlyTrendChart.destroy();
            
            monthlyTrendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: trendData.labels,
                    datasets: [{
                        label: 'Ventas ($)',
                        data: trendData.data,
                        fill: true,
                        backgroundColor: 'rgba(66, 133, 244, 0.1)',
                        borderColor: 'rgba(66, 133, 244, 1)',
                        borderWidth: 2,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            });
            
            // Gráfico de eficiencia de empleados
            const efficiencyData = AppData.getEmployeeEfficiency();
            const efficiencyCtx = document.getElementById('employeeEfficiencyChart').getContext('2d');
            
            if (employeeEfficiencyChart) employeeEfficiencyChart.destroy();
            
            employeeEfficiencyChart = new Chart(efficiencyCtx, {
                type: 'bar',
                data: {
                    labels: efficiencyData.map(e => e.name),
                    datasets: [
                        {
                            label: 'Ventas Totales ($)',
                            data: efficiencyData.map(e => e.totalSales),
                            backgroundColor: 'rgba(66, 133, 244, 0.7)',
                            borderColor: 'rgba(66, 133, 244, 1)',
                            borderWidth: 1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Eficiencia (%)',
                            data: efficiencyData.map(e => e.efficiency),
                            backgroundColor: 'rgba(52, 168, 83, 0.7)',
                            borderColor: 'rgba(52, 168, 83, 1)',
                            borderWidth: 1,
                            type: 'line',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
